{"version":3,"file":"index-6c1324ea.esm.js","sources":["../../src/apis.ts","../../src/components/Filters/FiltersButton.tsx","../../src/components/Filters/Filters.tsx","../../src/components/SearchContext/SearchContext.tsx","../../src/components/SearchTracker/SearchTracker.tsx","../../src/components/SearchBar/SearchBar.tsx","../../src/components/SearchFilter/hooks.ts","../../src/components/SearchFilter/SearchFilter.Autocomplete.tsx","../../src/components/SearchFilter/SearchFilter.tsx","../../src/components/DefaultResultListItem/DefaultResultListItem.tsx","../../src/components/SearchResult/SearchResult.tsx","../../src/components/SearchResultPager/SearchResultPager.tsx","../../src/plugin.ts","../../src/components/SearchModal/SearchModal.tsx","../../src/components/SearchModal/useSearchModal.tsx","../../src/components/LegacySearchPage/LegacySearchBar.tsx","../../src/components/LegacySearchPage/Filters/FiltersButton.tsx","../../src/components/LegacySearchPage/Filters/Filters.tsx","../../src/components/LegacySearchPage/LegacySearchResult.tsx","../../src/components/LegacySearchPage/LegacySearchPage.tsx","../../src/components/SearchPage/SearchPage.tsx","../../src/components/SearchType/SearchType.Accordion.tsx","../../src/components/SearchType/SearchType.Tabs.tsx","../../src/components/SearchType/SearchType.tsx","../../src/components/SidebarSearch/SidebarSearch.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  createApiRef,\n  DiscoveryApi,\n  IdentityApi,\n} from '@backstage/core-plugin-api';\nimport { ResponseError } from '@backstage/errors';\nimport { SearchQuery, SearchResultSet } from '@backstage/plugin-search-common';\nimport qs from 'qs';\n\nexport const searchApiRef = createApiRef<SearchApi>({\n  id: 'plugin.search.queryservice',\n});\n\nexport interface SearchApi {\n  query(query: SearchQuery): Promise<SearchResultSet>;\n}\n\nexport class SearchClient implements SearchApi {\n  private readonly discoveryApi: DiscoveryApi;\n  private readonly identityApi: IdentityApi;\n\n  constructor(options: {\n    discoveryApi: DiscoveryApi;\n    identityApi: IdentityApi;\n  }) {\n    this.discoveryApi = options.discoveryApi;\n    this.identityApi = options.identityApi;\n  }\n\n  async query(query: SearchQuery): Promise<SearchResultSet> {\n    const { token } = await this.identityApi.getCredentials();\n    const queryString = qs.stringify(query);\n    const url = `${await this.discoveryApi.getBaseUrl(\n      'search/query',\n    )}?${queryString}`;\n    const response = await fetch(url, {\n      headers: token ? { Authorization: `Bearer ${token}` } : {},\n    });\n\n    if (!response.ok) {\n      throw await ResponseError.fromResponse(response);\n    }\n\n    return response.json();\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport FilterListIcon from '@material-ui/icons/FilterList';\nimport { makeStyles, IconButton, Typography } from '@material-ui/core';\n\nconst useStyles = makeStyles(theme => ({\n  filters: {\n    width: '250px',\n    display: 'flex',\n  },\n  icon: {\n    margin: theme.spacing(-1, 0, 0, 0),\n  },\n}));\n\ntype FiltersButtonProps = {\n  numberOfSelectedFilters: number;\n  handleToggleFilters: () => void;\n};\n\nexport const FiltersButton = ({\n  numberOfSelectedFilters,\n  handleToggleFilters,\n}: FiltersButtonProps) => {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.filters}>\n      <IconButton\n        className={classes.icon}\n        aria-label=\"settings\"\n        onClick={handleToggleFilters}\n      >\n        <FilterListIcon />\n      </IconButton>\n      <Typography variant=\"h6\">\n        Filters ({numberOfSelectedFilters ? numberOfSelectedFilters : 0})\n      </Typography>\n    </div>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport {\n  makeStyles,\n  Typography,\n  Divider,\n  Card,\n  CardHeader,\n  Button,\n  CardContent,\n  Select,\n  Checkbox,\n  List,\n  ListItem,\n  ListItemText,\n  MenuItem,\n} from '@material-ui/core';\n\nconst useStyles = makeStyles(theme => ({\n  filters: {\n    background: 'transparent',\n    boxShadow: '0px 0px 0px 0px',\n  },\n  checkbox: {\n    padding: theme.spacing(0, 1, 0, 1),\n  },\n  dropdown: {\n    width: '100%',\n  },\n}));\n\nexport type FiltersState = {\n  selected: string;\n  checked: Array<string>;\n};\n\nexport type FilterOptions = {\n  kind: Array<string>;\n  lifecycle: Array<string>;\n};\n\ntype FiltersProps = {\n  filters: FiltersState;\n  filterOptions: FilterOptions;\n  resetFilters: () => void;\n  updateSelected: (filter: string) => void;\n  updateChecked: (filter: string) => void;\n};\n\nexport const Filters = ({\n  filters,\n  filterOptions,\n  resetFilters,\n  updateSelected,\n  updateChecked,\n}: FiltersProps) => {\n  const classes = useStyles();\n\n  return (\n    <Card className={classes.filters}>\n      <CardHeader\n        title={<Typography variant=\"h6\">Filters</Typography>}\n        action={\n          <Button color=\"primary\" onClick={() => resetFilters()}>\n            CLEAR ALL\n          </Button>\n        }\n      />\n      <Divider />\n      {filterOptions.kind.length === 0 && filterOptions.lifecycle.length === 0 && (\n        <CardContent>\n          <Typography variant=\"subtitle2\">\n            Filters cannot be applied to available results\n          </Typography>\n        </CardContent>\n      )}\n      {filterOptions.kind.length > 0 && (\n        <CardContent>\n          <Typography variant=\"subtitle2\">Kind</Typography>\n          <Select\n            id=\"outlined-select\"\n            onChange={(e: React.ChangeEvent<any>) =>\n              updateSelected(e?.target?.value)\n            }\n            variant=\"outlined\"\n            className={classes.dropdown}\n            value={filters.selected}\n          >\n            {filterOptions.kind.map(filter => (\n              <MenuItem\n                selected={filter === ''}\n                dense\n                key={filter}\n                value={filter}\n              >\n                {filter}\n              </MenuItem>\n            ))}\n          </Select>\n        </CardContent>\n      )}\n      {filterOptions.lifecycle.length > 0 && (\n        <CardContent>\n          <Typography variant=\"subtitle2\">Lifecycle</Typography>\n          <List disablePadding dense>\n            {filterOptions.lifecycle.map(filter => (\n              <ListItem\n                key={filter}\n                dense\n                button\n                onClick={() => updateChecked(filter)}\n              >\n                <Checkbox\n                  edge=\"start\"\n                  disableRipple\n                  className={classes.checkbox}\n                  color=\"primary\"\n                  checked={filters.checked.includes(filter)}\n                  tabIndex={-1}\n                  value={filter}\n                  name={filter}\n                />\n                <ListItemText id={filter} primary={filter} />\n              </ListItem>\n            ))}\n          </List>\n        </CardContent>\n      )}\n    </Card>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonObject } from '@backstage/types';\nimport { useApi, AnalyticsContext } from '@backstage/core-plugin-api';\nimport { SearchResultSet } from '@backstage/plugin-search-common';\nimport React, {\n  createContext,\n  PropsWithChildren,\n  useCallback,\n  useContext,\n  useEffect,\n  useState,\n} from 'react';\nimport useAsync, { AsyncState } from 'react-use/lib/useAsync';\nimport usePrevious from 'react-use/lib/usePrevious';\nimport { searchApiRef } from '../../apis';\n\ntype SearchContextValue = {\n  result: AsyncState<SearchResultSet>;\n  setTerm: React.Dispatch<React.SetStateAction<string>>;\n  setTypes: React.Dispatch<React.SetStateAction<string[]>>;\n  setFilters: React.Dispatch<React.SetStateAction<JsonObject>>;\n  setPageCursor: React.Dispatch<React.SetStateAction<string | undefined>>;\n  fetchNextPage?: React.DispatchWithoutAction;\n  fetchPreviousPage?: React.DispatchWithoutAction;\n} & SearchContextState;\n\n/**\n * The initial state of `SearchContextProvider`.\n *\n * @public\n */\nexport type SearchContextState = {\n  term: string;\n  types: string[];\n  filters: JsonObject;\n  pageCursor?: string;\n};\n\nexport const SearchContext = createContext<SearchContextValue | undefined>(\n  undefined,\n);\n\nconst searchInitialState: SearchContextState = {\n  term: '',\n  pageCursor: undefined,\n  filters: {},\n  types: [],\n};\n\nexport const SearchContextProvider = ({\n  initialState = searchInitialState,\n  children,\n}: PropsWithChildren<{ initialState?: SearchContextState }>) => {\n  const searchApi = useApi(searchApiRef);\n  const [pageCursor, setPageCursor] = useState<string | undefined>(\n    initialState.pageCursor,\n  );\n  const [filters, setFilters] = useState<JsonObject>(initialState.filters);\n  const [term, setTerm] = useState<string>(initialState.term);\n  const [types, setTypes] = useState<string[]>(initialState.types);\n\n  const prevTerm = usePrevious(term);\n\n  const result = useAsync(\n    () =>\n      searchApi.query({\n        term,\n        filters,\n        pageCursor,\n        types,\n      }),\n    [term, filters, types, pageCursor],\n  );\n\n  const hasNextPage =\n    !result.loading && !result.error && result.value?.nextPageCursor;\n  const hasPreviousPage =\n    !result.loading && !result.error && result.value?.previousPageCursor;\n  const fetchNextPage = useCallback(() => {\n    setPageCursor(result.value?.nextPageCursor);\n  }, [result.value?.nextPageCursor]);\n  const fetchPreviousPage = useCallback(() => {\n    setPageCursor(result.value?.previousPageCursor);\n  }, [result.value?.previousPageCursor]);\n\n  useEffect(() => {\n    // Any time a term is reset, we want to start from page 0.\n    if (term && prevTerm && term !== prevTerm) {\n      setPageCursor(undefined);\n    }\n  }, [term, prevTerm, initialState.pageCursor]);\n\n  const value: SearchContextValue = {\n    result,\n    filters,\n    setFilters,\n    term,\n    setTerm,\n    types,\n    setTypes,\n    pageCursor,\n    setPageCursor,\n    fetchNextPage: hasNextPage ? fetchNextPage : undefined,\n    fetchPreviousPage: hasPreviousPage ? fetchPreviousPage : undefined,\n  };\n\n  return (\n    <AnalyticsContext attributes={{ searchTypes: types.sort().join(',') }}>\n      <SearchContext.Provider value={value} children={children} />\n    </AnalyticsContext>\n  );\n};\n\nexport const useSearch = () => {\n  const context = useContext(SearchContext);\n  if (context === undefined) {\n    throw new Error('useSearch must be used within a SearchContextProvider');\n  }\n  return context;\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect } from 'react';\nimport { useAnalytics } from '@backstage/core-plugin-api';\nimport { useSearch } from '../SearchContext';\n\n/**\n * Capture search event on term change.\n */\nexport const TrackSearch = ({ children }: { children: React.ReactChild }) => {\n  const analytics = useAnalytics();\n  const { term } = useSearch();\n\n  useEffect(() => {\n    if (term) {\n      // Capture analytics search event with search term provided as value\n      analytics.captureEvent('search', term);\n    }\n  }, [analytics, term]);\n\n  return <>{children}</>;\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  ChangeEvent,\n  KeyboardEvent,\n  useState,\n  useEffect,\n  useCallback,\n  useContext,\n} from 'react';\nimport useDebounce from 'react-use/lib/useDebounce';\nimport { configApiRef, useApi } from '@backstage/core-plugin-api';\nimport {\n  InputBase,\n  InputBaseProps,\n  InputAdornment,\n  IconButton,\n} from '@material-ui/core';\nimport SearchIcon from '@material-ui/icons/Search';\nimport ClearButton from '@material-ui/icons/Clear';\n\nimport {\n  SearchContext,\n  SearchContextProvider,\n  useSearch,\n} from '../SearchContext';\nimport { TrackSearch } from '../SearchTracker';\n\n/**\n * Props for {@link SearchBarBase}.\n *\n * @public\n */\nexport type SearchBarBaseProps = Omit<InputBaseProps, 'onChange'> & {\n  debounceTime?: number;\n  clearButton?: boolean;\n  onClear?: () => void;\n  onSubmit?: () => void;\n  onChange: (value: string) => void;\n};\n\nconst useSearchContextCheck = () => {\n  const context = useContext(SearchContext);\n  return context !== undefined;\n};\n\n/**\n * All search boxes exported by the search plugin are based on the <SearchBarBase />,\n * and this one is based on the <InputBase /> component from Material UI.\n * Recommended if you don't use Search Provider or Search Context.\n *\n * @public\n */\nexport const SearchBarBase = ({\n  onChange,\n  onKeyDown,\n  onSubmit,\n  debounceTime = 200,\n  clearButton = true,\n  fullWidth = true,\n  value: defaultValue,\n  inputProps: defaultInputProps = {},\n  endAdornment: defaultEndAdornment,\n  ...props\n}: SearchBarBaseProps) => {\n  const configApi = useApi(configApiRef);\n  const [value, setValue] = useState<string>(defaultValue as string);\n  const hasSearchContext = useSearchContextCheck();\n\n  useEffect(() => {\n    setValue(prevValue =>\n      prevValue !== defaultValue ? (defaultValue as string) : prevValue,\n    );\n  }, [defaultValue]);\n\n  useDebounce(() => onChange(value), debounceTime, [value]);\n\n  const handleChange = useCallback(\n    (e: ChangeEvent<HTMLInputElement>) => {\n      setValue(e.target.value);\n    },\n    [setValue],\n  );\n\n  const handleKeyDown = useCallback(\n    (e: KeyboardEvent<HTMLInputElement>) => {\n      if (onKeyDown) onKeyDown(e);\n      if (onSubmit && e.key === 'Enter') {\n        onSubmit();\n      }\n    },\n    [onKeyDown, onSubmit],\n  );\n\n  const handleClear = useCallback(() => {\n    onChange('');\n  }, [onChange]);\n\n  const placeholder = `Search in ${\n    configApi.getOptionalString('app.title') || 'Backstage'\n  }`;\n\n  const startAdornment = (\n    <InputAdornment position=\"start\">\n      <IconButton aria-label=\"Query\" disabled>\n        <SearchIcon />\n      </IconButton>\n    </InputAdornment>\n  );\n\n  const endAdornment = (\n    <InputAdornment position=\"end\">\n      <IconButton aria-label=\"Clear\" onClick={handleClear}>\n        <ClearButton />\n      </IconButton>\n    </InputAdornment>\n  );\n\n  const searchBar = (\n    <TrackSearch>\n      <InputBase\n        data-testid=\"search-bar-next\"\n        value={value}\n        placeholder={placeholder}\n        startAdornment={startAdornment}\n        endAdornment={clearButton ? endAdornment : defaultEndAdornment}\n        inputProps={{ 'aria-label': 'Search', ...defaultInputProps }}\n        fullWidth={fullWidth}\n        onChange={handleChange}\n        onKeyDown={handleKeyDown}\n        {...props}\n      />\n    </TrackSearch>\n  );\n\n  return hasSearchContext ? (\n    searchBar\n  ) : (\n    <SearchContextProvider>{searchBar}</SearchContextProvider>\n  );\n};\n\n/**\n * Props for {@link SearchBar}.\n *\n * @public\n */\nexport type SearchBarProps = Partial<SearchBarBaseProps>;\n\n/**\n * Recommended search bar when you use the Search Provider or Search Context.\n *\n * @public\n */\nexport const SearchBar = ({ onChange, ...props }: SearchBarProps) => {\n  const { term, setTerm } = useSearch();\n\n  const handleChange = useCallback(\n    (newValue: string) => {\n      if (onChange) {\n        onChange(newValue);\n      } else {\n        setTerm(newValue);\n      }\n    },\n    [onChange, setTerm],\n  );\n\n  return <SearchBarBase value={term} onChange={handleChange} {...props} />;\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useRef } from 'react';\nimport useAsyncFn from 'react-use/lib/useAsyncFn';\nimport useDebounce from 'react-use/lib/useDebounce';\nimport { useSearch } from '../SearchContext';\n\n/**\n * Utility hook for either asynchronously loading filter values from a given\n * function or synchronously providing a given list of default values.\n */\nexport const useAsyncFilterValues = (\n  fn: ((partial: string) => Promise<string[]>) | undefined,\n  inputValue: string,\n  defaultValues: string[] = [],\n  debounce: number = 250,\n) => {\n  const valuesMemo = useRef<Record<string, string[] | Promise<string[]>>>({});\n  const definiteFn = fn || (() => Promise.resolve([]));\n\n  const [state, callback] = useAsyncFn(definiteFn, [inputValue], {\n    loading: true,\n  });\n\n  // Do not invoke the given function more than necessary.\n  useDebounce(\n    () => {\n      // Performance optimization: only invoke the callback once per inputValue\n      // for the lifetime of the hook/component.\n      if (valuesMemo.current[inputValue] === undefined) {\n        valuesMemo.current[inputValue] = callback(inputValue).then(values => {\n          // Overrite the value for future immediate returns.\n          valuesMemo.current[inputValue] = values;\n          return values;\n        });\n      }\n    },\n    debounce,\n    [callback, inputValue],\n  );\n\n  // Immediately return the default values if they are provided.\n  if (defaultValues.length) {\n    return {\n      loading: false,\n      value: defaultValues,\n    };\n  }\n\n  // Immediately return a memoized value if it is set (and not a promise).\n  const possibleValue = valuesMemo.current[inputValue];\n  if (Array.isArray(possibleValue)) {\n    return {\n      loading: false,\n      value: possibleValue,\n    };\n  }\n\n  return state;\n};\n\n/**\n * Utility hook for applying a given default value to the search context.\n */\nexport const useDefaultFilterValue = (\n  name: string,\n  defaultValue?: string | string[] | null,\n) => {\n  const { setFilters } = useSearch();\n\n  useEffect(() => {\n    if (defaultValue && [defaultValue].flat().length > 0) {\n      setFilters(prevFilters => ({\n        ...prevFilters,\n        [name]: defaultValue,\n      }));\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ChangeEvent, useState } from 'react';\nimport { Chip, TextField } from '@material-ui/core';\nimport {\n  Autocomplete,\n  AutocompleteGetTagProps,\n  AutocompleteRenderInputParams,\n} from '@material-ui/lab';\nimport { useSearch } from '../SearchContext';\nimport { useAsyncFilterValues, useDefaultFilterValue } from './hooks';\nimport { SearchFilterComponentProps } from './SearchFilter';\n\n/**\n * @public\n */\nexport type SearchAutocompleteFilterProps = SearchFilterComponentProps & {\n  filterSelectedOptions?: boolean;\n  limitTags?: number;\n  multiple?: boolean;\n};\n\nexport const AutocompleteFilter = (props: SearchAutocompleteFilterProps) => {\n  const {\n    className,\n    defaultValue,\n    name,\n    values: givenValues,\n    valuesDebounceMs,\n    label,\n    filterSelectedOptions,\n    limitTags,\n    multiple,\n  } = props;\n  const [inputValue, setInputValue] = useState<string>('');\n  useDefaultFilterValue(name, defaultValue);\n  const asyncValues =\n    typeof givenValues === 'function' ? givenValues : undefined;\n  const defaultValues =\n    typeof givenValues === 'function' ? undefined : givenValues;\n  const { value: values, loading } = useAsyncFilterValues(\n    asyncValues,\n    inputValue,\n    defaultValues,\n    valuesDebounceMs,\n  );\n  const { filters, setFilters } = useSearch();\n  const filterValue =\n    (filters[name] as string | string[] | undefined) || (multiple ? [] : null);\n\n  // Set new filter values on input change.\n  const handleChange = (\n    _: ChangeEvent<{}>,\n    newValue: string | string[] | null,\n  ) => {\n    setFilters(prevState => {\n      const { [name]: filter, ...others } = prevState;\n\n      if (newValue) {\n        return { ...others, [name]: newValue };\n      }\n      return { ...others };\n    });\n  };\n\n  // Provide the input field.\n  const renderInput = (params: AutocompleteRenderInputParams) => (\n    <TextField\n      {...params}\n      name=\"search\"\n      variant=\"outlined\"\n      label={label}\n      fullWidth\n    />\n  );\n\n  // Render tags as primary-colored chips.\n  const renderTags = (\n    tagValue: string[],\n    getTagProps: AutocompleteGetTagProps,\n  ) =>\n    tagValue.map((option: string, index: number) => (\n      <Chip label={option} color=\"primary\" {...getTagProps({ index })} />\n    ));\n\n  return (\n    <Autocomplete\n      filterSelectedOptions={filterSelectedOptions}\n      limitTags={limitTags}\n      multiple={multiple}\n      className={className}\n      id={`${multiple ? 'multi-' : ''}select-filter-${name}--select`}\n      options={values || []}\n      loading={loading}\n      value={filterValue}\n      onChange={handleChange}\n      onInputChange={(_, newValue) => setInputValue(newValue)}\n      renderInput={renderInput}\n      renderTags={renderTags}\n    />\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactElement, ChangeEvent } from 'react';\nimport {\n  makeStyles,\n  FormControl,\n  FormControlLabel,\n  InputLabel,\n  Checkbox,\n  Select,\n  MenuItem,\n  FormLabel,\n} from '@material-ui/core';\n\nimport {\n  AutocompleteFilter,\n  SearchAutocompleteFilterProps,\n} from './SearchFilter.Autocomplete';\nimport { useSearch } from '../SearchContext';\nimport { useAsyncFilterValues, useDefaultFilterValue } from './hooks';\n\nconst useStyles = makeStyles({\n  label: {\n    textTransform: 'capitalize',\n  },\n});\n\n/**\n * @public\n */\nexport type SearchFilterComponentProps = {\n  className?: string;\n  name: string;\n  label?: string;\n  /**\n   * Either an array of values directly, or an async function to return a list\n   * of values to be used in the filter. In the autocomplete filter, the last\n   * input value is provided as an input to allow values to be filtered. This\n   * function is debounced and values cached.\n   */\n  values?: string[] | ((partial: string) => Promise<string[]>);\n  defaultValue?: string[] | string | null;\n  /**\n   * Debounce time in milliseconds, used when values is an async callback.\n   * Defaults to 250ms.\n   */\n  valuesDebounceMs?: number;\n};\n\n/**\n * @public\n */\nexport type SearchFilterWrapperProps = SearchFilterComponentProps & {\n  component: (props: SearchFilterComponentProps) => ReactElement;\n  debug?: boolean;\n};\n\nconst CheckboxFilter = (props: SearchFilterComponentProps) => {\n  const {\n    className,\n    defaultValue,\n    label,\n    name,\n    values: givenValues = [],\n    valuesDebounceMs,\n  } = props;\n  const classes = useStyles();\n  const { filters, setFilters } = useSearch();\n  useDefaultFilterValue(name, defaultValue);\n  const asyncValues =\n    typeof givenValues === 'function' ? givenValues : undefined;\n  const defaultValues =\n    typeof givenValues === 'function' ? undefined : givenValues;\n  const { value: values = [], loading } = useAsyncFilterValues(\n    asyncValues,\n    '',\n    defaultValues,\n    valuesDebounceMs,\n  );\n\n  const handleChange = (e: ChangeEvent<HTMLInputElement>) => {\n    const {\n      target: { value, checked },\n    } = e;\n\n    setFilters(prevFilters => {\n      const { [name]: filter, ...others } = prevFilters;\n      const rest = ((filter as string[]) || []).filter(i => i !== value);\n      const items = checked ? [...rest, value] : rest;\n      return items.length ? { ...others, [name]: items } : others;\n    });\n  };\n\n  return (\n    <FormControl\n      className={className}\n      disabled={loading}\n      fullWidth\n      data-testid=\"search-checkboxfilter-next\"\n    >\n      {label ? <FormLabel className={classes.label}>{label}</FormLabel> : null}\n      {values.map((value: string) => (\n        <FormControlLabel\n          key={value}\n          control={\n            <Checkbox\n              color=\"primary\"\n              tabIndex={-1}\n              inputProps={{ 'aria-labelledby': value }}\n              value={value}\n              name={value}\n              onChange={handleChange}\n              checked={((filters[name] as string[]) ?? []).includes(value)}\n            />\n          }\n          label={value}\n        />\n      ))}\n    </FormControl>\n  );\n};\n\nconst SelectFilter = (props: SearchFilterComponentProps) => {\n  const {\n    className,\n    defaultValue,\n    label,\n    name,\n    values: givenValues,\n    valuesDebounceMs,\n  } = props;\n  const classes = useStyles();\n  useDefaultFilterValue(name, defaultValue);\n  const asyncValues =\n    typeof givenValues === 'function' ? givenValues : undefined;\n  const defaultValues =\n    typeof givenValues === 'function' ? undefined : givenValues;\n  const { value: values = [], loading } = useAsyncFilterValues(\n    asyncValues,\n    '',\n    defaultValues,\n    valuesDebounceMs,\n  );\n  const { filters, setFilters } = useSearch();\n\n  const handleChange = (e: ChangeEvent<{ value: unknown }>) => {\n    const {\n      target: { value },\n    } = e;\n\n    setFilters(prevFilters => {\n      const { [name]: filter, ...others } = prevFilters;\n      return value ? { ...others, [name]: value as string } : others;\n    });\n  };\n\n  return (\n    <FormControl\n      disabled={loading}\n      className={className}\n      variant=\"filled\"\n      fullWidth\n      data-testid=\"search-selectfilter-next\"\n    >\n      {label ? (\n        <InputLabel className={classes.label} margin=\"dense\">\n          {label}\n        </InputLabel>\n      ) : null}\n      <Select\n        variant=\"outlined\"\n        value={filters[name] || ''}\n        onChange={handleChange}\n      >\n        <MenuItem value=\"\">\n          <em>All</em>\n        </MenuItem>\n        {values.map((value: string) => (\n          <MenuItem key={value} value={value}>\n            {value}\n          </MenuItem>\n        ))}\n      </Select>\n    </FormControl>\n  );\n};\n\nconst SearchFilter = ({\n  component: Element,\n  ...props\n}: SearchFilterWrapperProps) => <Element {...props} />;\n\nSearchFilter.Checkbox = (\n  props: Omit<SearchFilterWrapperProps, 'component'> &\n    SearchFilterComponentProps,\n) => <SearchFilter {...props} component={CheckboxFilter} />;\n\nSearchFilter.Select = (\n  props: Omit<SearchFilterWrapperProps, 'component'> &\n    SearchFilterComponentProps,\n) => <SearchFilter {...props} component={SelectFilter} />;\n\n/**\n * A control surface for a given filter field name, rendered as an autocomplete\n * textfield. A hard-coded list of values may be provided, or an async function\n * which returns values may be provided instead.\n * @public\n */\nSearchFilter.Autocomplete = (props: SearchAutocompleteFilterProps) => (\n  <SearchFilter {...props} component={AutocompleteFilter} />\n);\n\n/**\n * @deprecated This component was used for rapid prototyping of the Backstage\n * Search platform. Now that the API has stabilized, you should use the\n * <SearchFilter /> component instead. This component will be removed in an\n * upcoming release.\n */\nconst SearchFilterNext = SearchFilter;\n\nexport { SearchFilter, SearchFilterNext };\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode } from 'react';\nimport { IndexableDocument } from '@backstage/plugin-search-common';\nimport {\n  ListItem,\n  ListItemIcon,\n  ListItemText,\n  Box,\n  Divider,\n} from '@material-ui/core';\nimport { Link } from '@backstage/core-components';\nimport TextTruncate from 'react-text-truncate';\n\ntype Props = {\n  icon?: ReactNode;\n  secondaryAction?: ReactNode;\n  result: IndexableDocument;\n  lineClamp?: number;\n};\n\nexport const DefaultResultListItem = ({\n  result,\n  icon,\n  secondaryAction,\n  lineClamp = 5,\n}: Props) => {\n  return (\n    <Link to={result.location}>\n      <ListItem alignItems=\"center\">\n        {icon && <ListItemIcon>{icon}</ListItemIcon>}\n        <ListItemText\n          primaryTypographyProps={{ variant: 'h6' }}\n          primary={result.title}\n          secondary={\n            <TextTruncate\n              line={lineClamp}\n              truncateText=\"â€¦\"\n              text={result.text}\n              element=\"span\"\n            />\n          }\n        />\n        {secondaryAction && <Box alignItems=\"flex-end\">{secondaryAction}</Box>}\n      </ListItem>\n      <Divider />\n    </Link>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  EmptyState,\n  Progress,\n  ResponseErrorPanel,\n} from '@backstage/core-components';\nimport { SearchResult } from '@backstage/plugin-search-common';\nimport React from 'react';\nimport { useSearch } from '../SearchContext';\n\ntype Props = {\n  children: (results: { results: SearchResult[] }) => JSX.Element;\n};\n\nexport const SearchResultComponent = ({ children }: Props) => {\n  const {\n    result: { loading, error, value },\n  } = useSearch();\n\n  if (loading) {\n    return <Progress />;\n  }\n  if (error) {\n    return (\n      <ResponseErrorPanel\n        title=\"Error encountered while fetching search results\"\n        error={error}\n      />\n    );\n  }\n\n  if (!value?.results.length) {\n    return <EmptyState missing=\"data\" title=\"Sorry, no results were found\" />;\n  }\n\n  return <>{children({ results: value.results })}</>;\n};\n\nexport { SearchResultComponent as SearchResult };\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button, makeStyles } from '@material-ui/core';\nimport ArrowBackIosIcon from '@material-ui/icons/ArrowBackIos';\nimport ArrowForwardIosIcon from '@material-ui/icons/ArrowForwardIos';\nimport React from 'react';\nimport { useSearch } from '../SearchContext';\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    justifyContent: 'space-between',\n    gap: theme.spacing(2),\n    margin: theme.spacing(2, 0),\n  },\n}));\n\nexport const SearchResultPager = () => {\n  const { fetchNextPage, fetchPreviousPage } = useSearch();\n  const classes = useStyles();\n\n  if (!fetchNextPage && !fetchPreviousPage) {\n    return <></>;\n  }\n\n  return (\n    <nav arial-label=\"pagination navigation\" className={classes.root}>\n      <Button\n        aria-label=\"previous page\"\n        disabled={!fetchPreviousPage}\n        onClick={fetchPreviousPage}\n        startIcon={<ArrowBackIosIcon />}\n      >\n        Previous\n      </Button>\n\n      <Button\n        aria-label=\"next page\"\n        disabled={!fetchNextPage}\n        onClick={fetchNextPage}\n        endIcon={<ArrowForwardIosIcon />}\n      >\n        Next\n      </Button>\n    </nav>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SearchClient, searchApiRef } from './apis';\nimport {\n  createApiFactory,\n  createPlugin,\n  createRouteRef,\n  createRoutableExtension,\n  discoveryApiRef,\n  createComponentExtension,\n  identityApiRef,\n} from '@backstage/core-plugin-api';\n\nexport const rootRouteRef = createRouteRef({\n  id: 'search',\n});\n\nexport const rootNextRouteRef = createRouteRef({\n  id: 'search:next',\n});\n\nexport const searchPlugin = createPlugin({\n  id: 'search',\n  apis: [\n    createApiFactory({\n      api: searchApiRef,\n      deps: { discoveryApi: discoveryApiRef, identityApi: identityApiRef },\n      factory: ({ discoveryApi, identityApi }) => {\n        return new SearchClient({ discoveryApi, identityApi });\n      },\n    }),\n  ],\n  routes: {\n    root: rootRouteRef,\n    nextRoot: rootNextRouteRef,\n  },\n});\n\nexport const SearchPage = searchPlugin.provide(\n  createRoutableExtension({\n    name: 'SearchPage',\n    component: () => import('./components/SearchPage').then(m => m.SearchPage),\n    mountPoint: rootRouteRef,\n  }),\n);\n\n/**\n * @deprecated This component was used for rapid prototyping of the Backstage\n * Search platform. Now that the API has stabilized, you should use the\n * <SearchPage /> component instead. This component will be removed in an\n * upcoming release.\n */\nexport const SearchPageNext = searchPlugin.provide(\n  createRoutableExtension({\n    name: 'SearchPageNext',\n    component: () => import('./components/SearchPage').then(m => m.SearchPage),\n    mountPoint: rootNextRouteRef,\n  }),\n);\n\nexport const SearchBar = searchPlugin.provide(\n  createComponentExtension({\n    name: 'SearchBar',\n    component: {\n      lazy: () => import('./components/SearchBar').then(m => m.SearchBar),\n    },\n  }),\n);\n\n/**\n * @deprecated This component was used for rapid prototyping of the Backstage\n * Search platform. Now that the API has stabilized, you should use the\n * <SearchBar /> component instead. This component will be removed in an\n * upcoming release.\n */\nexport const SearchBarNext = searchPlugin.provide(\n  createComponentExtension({\n    name: 'SearchBarNext',\n    component: {\n      lazy: () => import('./components/SearchBar').then(m => m.SearchBar),\n    },\n  }),\n);\n\nexport const SearchResult = searchPlugin.provide(\n  createComponentExtension({\n    name: 'SearchResult',\n    component: {\n      lazy: () => import('./components/SearchResult').then(m => m.SearchResult),\n    },\n  }),\n);\n\n/**\n * @deprecated This component was used for rapid prototyping of the Backstage\n * Search platform. Now that the API has stabilized, you should use the\n * <SearchResult /> component instead. This component will be removed in an\n * upcoming release.\n */\nexport const SearchResultNext = searchPlugin.provide(\n  createComponentExtension({\n    name: 'SearchResultNext',\n    component: {\n      lazy: () => import('./components/SearchResult').then(m => m.SearchResult),\n    },\n  }),\n);\n\nexport const SidebarSearchModal = searchPlugin.provide(\n  createComponentExtension({\n    name: 'SidebarSearchModal',\n    component: {\n      lazy: () =>\n        import('./components/SidebarSearchModal').then(\n          m => m.SidebarSearchModal,\n        ),\n    },\n  }),\n);\n\nexport const DefaultResultListItem = searchPlugin.provide(\n  createComponentExtension({\n    name: 'DefaultResultListItem',\n    component: {\n      lazy: () =>\n        import('./components/DefaultResultListItem').then(\n          m => m.DefaultResultListItem,\n        ),\n    },\n  }),\n);\n\nexport const HomePageSearchBar = searchPlugin.provide(\n  createComponentExtension({\n    name: 'HomePageSearchBar',\n    component: {\n      lazy: () =>\n        import('./components/HomePageComponent').then(m => m.HomePageSearchBar),\n    },\n  }),\n);\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport {\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Divider,\n  Grid,\n  List,\n  Paper,\n  useTheme,\n} from '@material-ui/core';\nimport LaunchIcon from '@material-ui/icons/Launch';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { SearchBar } from '../SearchBar';\nimport { DefaultResultListItem } from '../DefaultResultListItem';\nimport { SearchResult } from '../SearchResult';\nimport { SearchContextProvider, useSearch } from '../SearchContext';\nimport { SearchResultPager } from '../SearchResultPager';\nimport { useRouteRef } from '@backstage/core-plugin-api';\nimport { Link, useContent } from '@backstage/core-components';\nimport { rootRouteRef } from '../../plugin';\n\nexport interface SearchModalProps {\n  /**\n   * If true, it renders the modal.\n   */\n  open?: boolean;\n  /**\n   * This is supposed to be used together with the open prop.\n   * If `hidden` is true, it hides the modal.\n   * If `open` is false, the value of `hidden` has no effect on the modal.\n   * Use `open` for controlling whether the modal should be rendered or not.\n   */\n  hidden?: boolean;\n  /**\n   * a function invoked when a search item is pressed or when the dialog\n   * should be closed.\n   */\n  toggleModal: () => void;\n}\n\nconst useStyles = makeStyles(theme => ({\n  container: {\n    borderRadius: 30,\n    display: 'flex',\n    height: '2.4em',\n  },\n  input: {\n    flex: 1,\n  },\n  // Reduces default height of the modal, keeping a gap of 128px between the top and bottom of the page.\n  paperFullWidth: { height: 'calc(100% - 128px)' },\n  dialogActionsContainer: { padding: theme.spacing(1, 3) },\n  viewResultsLink: { verticalAlign: '0.5em' },\n}));\n\nexport const Modal = ({ toggleModal }: SearchModalProps) => {\n  const getSearchLink = useRouteRef(rootRouteRef);\n  const classes = useStyles();\n\n  const { term } = useSearch();\n  const { focusContent } = useContent();\n  const { transitions } = useTheme();\n\n  const handleResultClick = () => {\n    toggleModal();\n    setTimeout(focusContent, transitions.duration.leavingScreen);\n  };\n\n  const handleKeyPress = () => {\n    handleResultClick();\n  };\n\n  return (\n    <>\n      <DialogTitle>\n        <Paper className={classes.container}>\n          <SearchBar className={classes.input} />\n        </Paper>\n      </DialogTitle>\n      <DialogContent>\n        <Grid\n          container\n          direction=\"row-reverse\"\n          justifyContent=\"flex-start\"\n          alignItems=\"center\"\n        >\n          <Grid item>\n            <Link\n              onClick={() => {\n                toggleModal();\n                setTimeout(focusContent, transitions.duration.leavingScreen);\n              }}\n              to={`${getSearchLink()}?query=${term}`}\n            >\n              <span className={classes.viewResultsLink}>View Full Results</span>\n              <LaunchIcon color=\"primary\" />\n            </Link>\n          </Grid>\n        </Grid>\n        <Divider />\n        <SearchResult>\n          {({ results }) => (\n            <List>\n              {results.map(({ document }) => (\n                <div\n                  role=\"button\"\n                  tabIndex={0}\n                  key={`${document.location}-btn`}\n                  onClick={handleResultClick}\n                  onKeyPress={handleKeyPress}\n                >\n                  <DefaultResultListItem\n                    key={document.location}\n                    result={document}\n                  />\n                </div>\n              ))}\n            </List>\n          )}\n        </SearchResult>\n      </DialogContent>\n      <DialogActions className={classes.dialogActionsContainer}>\n        <Grid container direction=\"row\">\n          <Grid item xs={12}>\n            <SearchResultPager />\n          </Grid>\n        </Grid>\n      </DialogActions>\n    </>\n  );\n};\n\nexport const SearchModal = ({\n  open = true,\n  hidden,\n  toggleModal,\n}: SearchModalProps) => {\n  const classes = useStyles();\n\n  return (\n    <Dialog\n      classes={{\n        paperFullWidth: classes.paperFullWidth,\n      }}\n      onClose={toggleModal}\n      aria-labelledby=\"search-modal-title\"\n      fullWidth\n      maxWidth=\"lg\"\n      open={open}\n      hidden={hidden}\n    >\n      {open && (\n        <SearchContextProvider>\n          <Modal toggleModal={toggleModal} />\n        </SearchContextProvider>\n      )}\n    </Dialog>\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useState } from 'react';\n\n/**\n * Use this hook to manage the state of {@link SearchModal}\n * and change its visibility.\n *\n * @public\n *\n * @param initialState - pass `true` to make the modal initially visible\n * @returns an object containing the state of the modal together with\n * functions for changing the visibility of the modal.\n */\nexport function useSearchModal(initialState = false) {\n  const [state, setState] = useState({\n    hidden: !initialState,\n    open: initialState,\n  });\n\n  const toggleModal = useCallback(\n    () =>\n      setState(prevState => ({\n        open: true,\n        hidden: !prevState.hidden,\n      })),\n    [],\n  );\n\n  const setOpen = useCallback(\n    (open: boolean) =>\n      setState(prevState => ({\n        open: prevState.open || open,\n        hidden: !open,\n      })),\n    [],\n  );\n\n  return { state, toggleModal, setOpen };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { Paper } from '@material-ui/core';\nimport InputBase from '@material-ui/core/InputBase';\nimport IconButton from '@material-ui/core/IconButton';\nimport SearchIcon from '@material-ui/icons/Search';\nimport ClearButton from '@material-ui/icons/Clear';\n\nconst useStyles = makeStyles(() => ({\n  root: {\n    display: 'flex',\n    alignItems: 'center',\n  },\n  input: {\n    flex: 1,\n  },\n}));\n\ntype SearchBarProps = {\n  searchQuery: string;\n  handleSearch: any;\n  handleClearSearchBar: any;\n};\n\nexport const SearchBar = ({\n  searchQuery,\n  handleSearch,\n  handleClearSearchBar,\n}: SearchBarProps) => {\n  const classes = useStyles();\n\n  return (\n    <Paper\n      component=\"form\"\n      onSubmit={e => handleSearch(e)}\n      className={classes.root}\n    >\n      <IconButton disabled type=\"submit\" aria-label=\"search\">\n        <SearchIcon />\n      </IconButton>\n      <InputBase\n        className={classes.input}\n        placeholder=\"Search in Backstage\"\n        value={searchQuery}\n        onChange={e => handleSearch(e)}\n        inputProps={{ 'aria-label': 'search backstage' }}\n      />\n      <IconButton aria-label=\"search\" onClick={() => handleClearSearchBar()}>\n        <ClearButton />\n      </IconButton>\n    </Paper>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport FilterListIcon from '@material-ui/icons/FilterList';\nimport { makeStyles, IconButton, Typography } from '@material-ui/core';\n\nconst useStyles = makeStyles(theme => ({\n  filters: {\n    width: '250px',\n    display: 'flex',\n  },\n  icon: {\n    margin: theme.spacing(-1, 0, 0, 0),\n  },\n}));\n\ntype FiltersButtonProps = {\n  numberOfSelectedFilters: number;\n  handleToggleFilters: () => void;\n};\n\nexport const FiltersButton = ({\n  numberOfSelectedFilters,\n  handleToggleFilters,\n}: FiltersButtonProps) => {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.filters}>\n      <IconButton\n        className={classes.icon}\n        aria-label=\"settings\"\n        onClick={handleToggleFilters}\n      >\n        <FilterListIcon />\n      </IconButton>\n      <Typography variant=\"h6\">\n        Filters ({numberOfSelectedFilters ? numberOfSelectedFilters : 0})\n      </Typography>\n    </div>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport {\n  makeStyles,\n  Typography,\n  Divider,\n  Card,\n  CardHeader,\n  Button,\n  CardContent,\n  Select,\n  Checkbox,\n  List,\n  ListItem,\n  ListItemText,\n  MenuItem,\n} from '@material-ui/core';\n\nconst useStyles = makeStyles(theme => ({\n  filters: {\n    background: 'transparent',\n    boxShadow: '0px 0px 0px 0px',\n  },\n  checkbox: {\n    padding: theme.spacing(0, 1, 0, 1),\n  },\n  dropdown: {\n    width: '100%',\n  },\n}));\n\nexport type FiltersState = {\n  selected: string;\n  checked: Array<string>;\n};\n\nexport type FilterOptions = {\n  kind: Array<string>;\n  lifecycle: Array<string>;\n};\n\ntype FiltersProps = {\n  filters: FiltersState;\n  filterOptions: FilterOptions;\n  resetFilters: () => void;\n  updateSelected: (filter: string) => void;\n  updateChecked: (filter: string) => void;\n};\n\nexport const Filters = ({\n  filters,\n  filterOptions,\n  resetFilters,\n  updateSelected,\n  updateChecked,\n}: FiltersProps) => {\n  const classes = useStyles();\n\n  return (\n    <Card className={classes.filters}>\n      <CardHeader\n        title={<Typography variant=\"h6\">Filters</Typography>}\n        action={\n          <Button color=\"primary\" onClick={() => resetFilters()}>\n            CLEAR ALL\n          </Button>\n        }\n      />\n      <Divider />\n      {filterOptions.kind.length === 0 && filterOptions.lifecycle.length === 0 && (\n        <CardContent>\n          <Typography variant=\"subtitle2\">\n            Filters cannot be applied to available results\n          </Typography>\n        </CardContent>\n      )}\n      {filterOptions.kind.length > 0 && (\n        <CardContent>\n          <Typography variant=\"subtitle2\">Kind</Typography>\n          <Select\n            id=\"outlined-select\"\n            onChange={(e: React.ChangeEvent<any>) =>\n              updateSelected(e?.target?.value)\n            }\n            variant=\"outlined\"\n            className={classes.dropdown}\n            value={filters.selected}\n          >\n            {filterOptions.kind.map(filter => (\n              <MenuItem\n                selected={filter === ''}\n                dense\n                key={filter}\n                value={filter}\n              >\n                {filter}\n              </MenuItem>\n            ))}\n          </Select>\n        </CardContent>\n      )}\n      {filterOptions.lifecycle.length > 0 && (\n        <CardContent>\n          <Typography variant=\"subtitle2\">Lifecycle</Typography>\n          <List disablePadding dense>\n            {filterOptions.lifecycle.map(filter => (\n              <ListItem\n                key={filter}\n                dense\n                button\n                onClick={() => updateChecked(filter)}\n              >\n                <Checkbox\n                  edge=\"start\"\n                  disableRipple\n                  className={classes.checkbox}\n                  color=\"primary\"\n                  checked={filters.checked.includes(filter)}\n                  tabIndex={-1}\n                  value={filter}\n                  name={filter}\n                />\n                <ListItemText id={filter} primary={filter} />\n              </ListItem>\n            ))}\n          </List>\n        </CardContent>\n      )}\n    </Card>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Divider, Grid, makeStyles, Typography } from '@material-ui/core';\nimport { Alert } from '@material-ui/lab';\nimport React, { useEffect, useState } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\nimport { catalogApiRef } from '@backstage/plugin-catalog-react';\n\nimport { Filters, FiltersButton, FiltersState } from './Filters';\nimport { Entity, DEFAULT_NAMESPACE } from '@backstage/catalog-model';\n\nimport {\n  EmptyState,\n  Link,\n  Progress,\n  Table,\n  TableColumn,\n} from '@backstage/core-components';\nimport { useApi } from '@backstage/core-plugin-api';\n\ntype Result = {\n  name: string;\n  description: string | undefined;\n  owner: string | undefined;\n  kind: string;\n  lifecycle: string | undefined;\n  url: string;\n};\ntype SearchResults = Array<Result>;\n\nconst useStyles = makeStyles(theme => ({\n  searchQuery: {\n    color: theme.palette.text.primary,\n    background: theme.palette.background.default,\n    borderRadius: '10%',\n  },\n  tableHeader: {\n    margin: theme.spacing(1, 0, 0, 0),\n    display: 'flex',\n  },\n  divider: {\n    width: '1px',\n    margin: theme.spacing(0, 2),\n    padding: theme.spacing(2, 0),\n  },\n}));\n\ntype SearchResultProps = {\n  searchQuery?: string;\n};\n\ntype TableHeaderProps = {\n  searchQuery?: string;\n  numberOfSelectedFilters: number;\n  numberOfResults: number;\n  handleToggleFilters: () => void;\n};\n\n// TODO: move out column to make the search result component more generic\nconst columns: TableColumn[] = [\n  {\n    title: 'Name',\n    field: 'name',\n    highlight: true,\n    render: (result: Partial<Result>) => (\n      <Link to={result.url || ''}>{result.name}</Link>\n    ),\n  },\n  {\n    title: 'Description',\n    field: 'description',\n  },\n  {\n    title: 'Owner',\n    field: 'owner',\n  },\n  {\n    title: 'Kind',\n    field: 'kind',\n  },\n  {\n    title: 'LifeCycle',\n    field: 'lifecycle',\n  },\n];\n\nconst TableHeader = ({\n  searchQuery,\n  numberOfSelectedFilters,\n  numberOfResults,\n  handleToggleFilters,\n}: TableHeaderProps) => {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.tableHeader}>\n      <FiltersButton\n        numberOfSelectedFilters={numberOfSelectedFilters}\n        handleToggleFilters={handleToggleFilters}\n      />\n      <Divider className={classes.divider} orientation=\"vertical\" />\n      <Grid item xs={12}>\n        {searchQuery ? (\n          <Typography variant=\"h6\">\n            {`${numberOfResults} `}\n            {numberOfResults > 1 ? `results for ` : `result for `}\n            <span className={classes.searchQuery}>\"{searchQuery}\"</span>{' '}\n          </Typography>\n        ) : (\n          <Typography variant=\"h6\">{`${numberOfResults} results`}</Typography>\n        )}\n      </Grid>\n    </div>\n  );\n};\n\nexport const SearchResult = ({ searchQuery }: SearchResultProps) => {\n  const catalogApi = useApi(catalogApiRef);\n\n  const [showFilters, toggleFilters] = useState(false);\n  const [selectedFilters, setSelectedFilters] = useState<FiltersState>({\n    selected: '',\n    checked: [],\n  });\n\n  const [filteredResults, setFilteredResults] = useState<SearchResults>([]);\n\n  const {\n    loading,\n    error,\n    value: results,\n  } = useAsync(async () => {\n    const entities = await catalogApi.getEntities();\n    return entities.items.map((entity: Entity) => ({\n      name: entity.metadata.name,\n      description: entity.metadata.description,\n      owner:\n        typeof entity.spec?.owner === 'string' ? entity.spec?.owner : undefined,\n      kind: entity.kind,\n      lifecycle:\n        typeof entity.spec?.lifecycle === 'string'\n          ? entity.spec?.lifecycle\n          : undefined,\n      url: `/catalog/${\n        entity.metadata.namespace?.toLocaleLowerCase('en-US') ||\n        DEFAULT_NAMESPACE\n      }/${entity.kind.toLocaleLowerCase('en-US')}/${entity.metadata.name}`,\n    }));\n  }, []);\n\n  useEffect(() => {\n    if (results) {\n      let withFilters = results;\n\n      // apply filters\n\n      // filter on selected\n      if (selectedFilters.selected !== '') {\n        withFilters = results.filter((result: Result) =>\n          selectedFilters.selected.includes(result.kind),\n        );\n      }\n\n      // filter on checked\n      if (selectedFilters.checked.length > 0) {\n        withFilters = withFilters.filter(\n          (result: Result) =>\n            result.lifecycle &&\n            selectedFilters.checked.includes(result.lifecycle),\n        );\n      }\n\n      // filter on searchQuery\n      if (searchQuery) {\n        withFilters = withFilters.filter(\n          (result: Result) =>\n            result.name?.toLocaleLowerCase('en-US').includes(searchQuery) ||\n            result.name\n              ?.toLocaleLowerCase('en-US')\n              .includes(searchQuery.split(' ').join('-')) ||\n            result.description\n              ?.toLocaleLowerCase('en-US')\n              .includes(searchQuery),\n        );\n      }\n\n      setFilteredResults(withFilters);\n    }\n  }, [selectedFilters, searchQuery, results]);\n  if (loading) {\n    return <Progress />;\n  }\n  if (error) {\n    return (\n      <Alert severity=\"error\">\n        Error encountered while fetching search results. {error.toString()}\n      </Alert>\n    );\n  }\n  if (!results || results.length === 0) {\n    return <EmptyState missing=\"data\" title=\"Sorry, no results were found\" />;\n  }\n\n  const resetFilters = () => {\n    setSelectedFilters({\n      selected: '',\n      checked: [],\n    });\n  };\n\n  const updateSelected = (filter: string) => {\n    setSelectedFilters(prevState => ({\n      ...prevState,\n      selected: filter,\n    }));\n  };\n\n  const updateChecked = (filter: string) => {\n    if (selectedFilters.checked.includes(filter)) {\n      setSelectedFilters(prevState => ({\n        ...prevState,\n        checked: prevState.checked.filter(item => item !== filter),\n      }));\n      return;\n    }\n\n    setSelectedFilters(prevState => ({\n      ...prevState,\n      checked: [...prevState.checked, filter],\n    }));\n  };\n\n  const filterOptions = results.reduce(\n    (acc, curr) => {\n      if (curr.kind && acc.kind.indexOf(curr.kind) < 0) {\n        acc.kind.push(curr.kind);\n      }\n      if (curr.lifecycle && acc.lifecycle.indexOf(curr.lifecycle) < 0) {\n        acc.lifecycle.push(curr.lifecycle);\n      }\n      return acc;\n    },\n    {\n      kind: [] as Array<string>,\n      lifecycle: [] as Array<string>,\n    },\n  );\n\n  return (\n    <>\n      <Grid container>\n        {showFilters && (\n          <Grid item xs={3}>\n            <Filters\n              filters={selectedFilters}\n              filterOptions={filterOptions}\n              resetFilters={resetFilters}\n              updateSelected={updateSelected}\n              updateChecked={updateChecked}\n            />\n          </Grid>\n        )}\n        <Grid item xs={showFilters ? 9 : 12}>\n          <Table\n            options={{ paging: true, pageSize: 20, search: false }}\n            data={filteredResults}\n            columns={columns}\n            title={\n              <TableHeader\n                searchQuery={searchQuery}\n                numberOfResults={filteredResults.length}\n                numberOfSelectedFilters={\n                  (selectedFilters.selected !== '' ? 1 : 0) +\n                  selectedFilters.checked.length\n                }\n                handleToggleFilters={() => toggleFilters(!showFilters)}\n              />\n            }\n          />\n        </Grid>\n      </Grid>\n    </>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Grid } from '@material-ui/core';\nimport React, { useEffect, useState } from 'react';\nimport useDebounce from 'react-use/lib/useDebounce';\nimport { SearchBar } from './LegacySearchBar';\nimport { SearchResult } from './LegacySearchResult';\nimport {\n  Content,\n  Header,\n  Page,\n  useQueryParamState,\n} from '@backstage/core-components';\n\n/**\n * @deprecated This SearchPage, powered directly by the Catalog API, will be\n * removed from a future release of this plugin.\n */\nexport const LegacySearchPage = () => {\n  const [queryString, setQueryString] = useQueryParamState<string>('query');\n  const [searchQuery, setSearchQuery] = useState(queryString ?? '');\n\n  const handleSearch = (event: React.ChangeEvent<HTMLInputElement>) => {\n    event.preventDefault();\n    setSearchQuery(event.target.value);\n  };\n\n  useEffect(() => setSearchQuery(queryString ?? ''), [queryString]);\n\n  useDebounce(\n    () => {\n      setQueryString(searchQuery);\n    },\n    200,\n    [searchQuery],\n  );\n\n  const handleClearSearchBar = () => {\n    setSearchQuery('');\n  };\n\n  return (\n    <Page themeId=\"home\">\n      <Header title=\"Search\" />\n      <Content>\n        <Grid container direction=\"row\">\n          <Grid item xs={12}>\n            <SearchBar\n              handleSearch={handleSearch}\n              handleClearSearchBar={handleClearSearchBar}\n              searchQuery={searchQuery}\n            />\n          </Grid>\n          <Grid item xs={12}>\n            <SearchResult\n              searchQuery={(queryString ?? '').toLocaleLowerCase('en-US')}\n            />\n          </Grid>\n        </Grid>\n      </Content>\n    </Page>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect } from 'react';\nimport usePrevious from 'react-use/lib/usePrevious';\nimport qs from 'qs';\nimport { useLocation, useOutlet } from 'react-router';\nimport { SearchContextProvider, useSearch } from '../SearchContext';\nimport { JsonObject } from '@backstage/types';\nimport { LegacySearchPage } from '../LegacySearchPage';\n\nexport const UrlUpdater = () => {\n  const location = useLocation();\n  const {\n    term,\n    setTerm,\n    types,\n    setTypes,\n    pageCursor,\n    setPageCursor,\n    filters,\n    setFilters,\n  } = useSearch();\n\n  const prevQueryParams = usePrevious(location.search);\n  useEffect(() => {\n    // Only respond to changes to url query params\n    if (location.search === prevQueryParams) {\n      return;\n    }\n\n    const query =\n      qs.parse(location.search.substring(1), { arrayLimit: 0 }) || {};\n\n    if (query.filters) {\n      setFilters(query.filters as JsonObject);\n    }\n\n    if (query.query) {\n      setTerm(query.query as string);\n    }\n\n    if (query.pageCursor) {\n      setPageCursor(query.pageCursor as string);\n    }\n\n    if (query.types) {\n      setTypes(query.types as string[]);\n    }\n  }, [prevQueryParams, location, setTerm, setTypes, setPageCursor, setFilters]);\n\n  useEffect(() => {\n    const newParams = qs.stringify(\n      {\n        query: term,\n        types,\n        pageCursor,\n        filters,\n      },\n      { arrayFormat: 'brackets' },\n    );\n    const newUrl = `${window.location.pathname}?${newParams}`;\n\n    // We directly manipulate window history here in order to not re-render\n    // infinitely (state => location => state => etc). The intention of this\n    // code is just to ensure the right query/filters are loaded when a user\n    // clicks the \"back\" button after clicking a result.\n    window.history.replaceState(null, document.title, newUrl);\n  }, [term, types, pageCursor, filters]);\n\n  return null;\n};\n\nexport const SearchPage = () => {\n  const outlet = useOutlet();\n\n  return (\n    <SearchContextProvider>\n      <UrlUpdater />\n      {outlet || <LegacySearchPage />}\n    </SearchContextProvider>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { cloneElement, Fragment, useEffect, useState } from 'react';\nimport { useSearch } from '../SearchContext';\nimport {\n  Accordion,\n  AccordionSummary,\n  AccordionDetails,\n  Card,\n  CardContent,\n  CardHeader,\n  Divider,\n  List,\n  ListItem,\n  ListItemIcon,\n  ListItemText,\n  makeStyles,\n} from '@material-ui/core';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport AllIcon from '@material-ui/icons/FontDownload';\n\nconst useStyles = makeStyles(theme => ({\n  card: {\n    backgroundColor: 'rgba(0, 0, 0, .11)',\n  },\n  cardContent: {\n    paddingTop: theme.spacing(1),\n  },\n  icon: {\n    color: theme.palette.common.black,\n  },\n  list: {\n    width: '100%',\n  },\n  listItemIcon: {\n    width: '24px',\n    height: '24px',\n  },\n  accordion: {\n    backgroundColor: theme.palette.background.paper,\n  },\n  accordionSummary: {\n    minHeight: 'auto',\n    '&.Mui-expanded': {\n      minHeight: 'auto',\n    },\n  },\n  accordionSummaryContent: {\n    margin: theme.spacing(2, 0),\n    '&.Mui-expanded': {\n      margin: theme.spacing(2, 0),\n    },\n  },\n  accordionDetails: {\n    padding: theme.spacing(0, 0, 1),\n  },\n}));\n\n/**\n * @public\n */\nexport type SearchTypeAccordionProps = {\n  name: string;\n  types: Array<{\n    value: string;\n    name: string;\n    icon: JSX.Element;\n  }>;\n  defaultValue?: string;\n};\n\nexport const SearchTypeAccordion = (props: SearchTypeAccordionProps) => {\n  const classes = useStyles();\n  const { setPageCursor, setTypes, types } = useSearch();\n  const [expanded, setExpanded] = useState(true);\n  const { defaultValue, name, types: givenTypes } = props;\n\n  const toggleExpanded = () => setExpanded(prevState => !prevState);\n  const handleClick = (type: string) => {\n    return () => {\n      setTypes(type !== '' ? [type] : []);\n      setPageCursor(undefined);\n      setExpanded(false);\n    };\n  };\n\n  // Handle any provided defaultValue\n  useEffect(() => {\n    if (defaultValue) {\n      setTypes([defaultValue]);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const definedTypes = [\n    {\n      value: '',\n      name: 'All',\n      icon: <AllIcon />,\n    },\n    ...givenTypes,\n  ];\n  const selected = types[0] || '';\n\n  return (\n    <Card className={classes.card}>\n      <CardHeader title={name} titleTypographyProps={{ variant: 'overline' }} />\n      <CardContent className={classes.cardContent}>\n        <Accordion\n          className={classes.accordion}\n          expanded={expanded}\n          onChange={toggleExpanded}\n        >\n          <AccordionSummary\n            classes={{\n              root: classes.accordionSummary,\n              content: classes.accordionSummaryContent,\n            }}\n            expandIcon={<ExpandMoreIcon className={classes.icon} />}\n            IconButtonProps={{ size: 'small' }}\n          >\n            {expanded\n              ? 'Collapse'\n              : definedTypes.filter(t => t.value === selected)[0]!.name}\n          </AccordionSummary>\n          <AccordionDetails classes={{ root: classes.accordionDetails }}>\n            <List\n              className={classes.list}\n              component=\"nav\"\n              aria-label=\"filter by type\"\n              disablePadding\n              dense\n            >\n              {definedTypes.map(type => (\n                <Fragment key={type.value}>\n                  <Divider />\n                  <ListItem\n                    selected={\n                      types[0] === type.value ||\n                      (types.length === 0 && type.value === '')\n                    }\n                    onClick={handleClick(type.value)}\n                    button\n                  >\n                    <ListItemIcon>\n                      {cloneElement(type.icon, {\n                        className: classes.listItemIcon,\n                      })}\n                    </ListItemIcon>\n                    <ListItemText primary={type.name} />\n                  </ListItem>\n                </Fragment>\n              ))}\n            </List>\n          </AccordionDetails>\n        </Accordion>\n      </CardContent>\n    </Card>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect } from 'react';\nimport { useSearch } from '../SearchContext';\nimport { BackstageTheme } from '@backstage/theme';\nimport { makeStyles, Tab, Tabs } from '@material-ui/core';\n\nconst useStyles = makeStyles((theme: BackstageTheme) => ({\n  tabs: {\n    borderBottom: `1px solid ${theme.palette.textVerySubtle}`,\n    padding: theme.spacing(0, 4),\n  },\n  tab: {\n    height: '50px',\n    fontWeight: theme.typography.fontWeightBold,\n    fontSize: theme.typography.pxToRem(13),\n    color: theme.palette.textSubtle,\n    minWidth: '130px',\n  },\n}));\n\n/**\n * @public\n */\nexport type SearchTypeTabsProps = {\n  types: Array<{\n    value: string;\n    name: string;\n  }>;\n  defaultValue?: string;\n};\n\nexport const SearchTypeTabs = (props: SearchTypeTabsProps) => {\n  const classes = useStyles();\n  const { setPageCursor, setTypes, types } = useSearch();\n  const { defaultValue, types: givenTypes } = props;\n\n  const changeTab = (_: React.ChangeEvent<{}>, newType: string) => {\n    setTypes(newType !== '' ? [newType] : []);\n    setPageCursor(undefined);\n  };\n\n  // Handle any provided defaultValue\n  useEffect(() => {\n    if (defaultValue) {\n      setTypes([defaultValue]);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const definedTypes = [\n    {\n      value: '',\n      name: 'All',\n    },\n    ...givenTypes,\n  ];\n\n  return (\n    <Tabs\n      className={classes.tabs}\n      indicatorColor=\"primary\"\n      value={types.length === 0 ? '' : types[0]}\n      onChange={changeTab}\n    >\n      {definedTypes.map(type => (\n        <Tab\n          className={classes.tab}\n          disableRipple\n          label={type.name}\n          value={type.value}\n        />\n      ))}\n    </Tabs>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  Checkbox,\n  Chip,\n  FormControl,\n  InputLabel,\n  ListItemText,\n  makeStyles,\n  MenuItem,\n  Select,\n} from '@material-ui/core';\nimport React, { ChangeEvent } from 'react';\nimport useEffectOnce from 'react-use/lib/useEffectOnce';\nimport {\n  SearchTypeAccordion,\n  SearchTypeAccordionProps,\n} from './SearchType.Accordion';\nimport { SearchTypeTabs, SearchTypeTabsProps } from './SearchType.Tabs';\nimport { useSearch } from '../SearchContext';\n\nconst useStyles = makeStyles(theme => ({\n  label: {\n    textTransform: 'capitalize',\n  },\n  chips: {\n    display: 'flex',\n    flexWrap: 'wrap',\n    marginTop: theme.spacing(1),\n  },\n  chip: {\n    margin: 2,\n  },\n}));\n\n/**\n * @public\n */\nexport type SearchTypeProps = {\n  className?: string;\n  name: string;\n  values?: string[];\n  defaultValue?: string[] | string | null;\n};\n\nconst SearchType = (props: SearchTypeProps) => {\n  const { className, defaultValue, name, values = [] } = props;\n  const classes = useStyles();\n  const { types, setTypes } = useSearch();\n\n  useEffectOnce(() => {\n    if (!types.length) {\n      if (defaultValue && Array.isArray(defaultValue)) {\n        setTypes(defaultValue);\n      } else if (defaultValue) {\n        setTypes([defaultValue]);\n      }\n    }\n  });\n\n  const handleChange = (e: ChangeEvent<{ value: unknown }>) => {\n    const value = e.target.value as string[];\n    setTypes(value as string[]);\n  };\n\n  return (\n    <FormControl\n      className={className}\n      variant=\"filled\"\n      fullWidth\n      data-testid=\"search-typefilter-next\"\n    >\n      <InputLabel className={classes.label} margin=\"dense\">\n        {name}\n      </InputLabel>\n      <Select\n        multiple\n        variant=\"outlined\"\n        value={types}\n        onChange={handleChange}\n        placeholder=\"All Results\"\n        renderValue={selected => (\n          <div className={classes.chips}>\n            {(selected as string[]).map(value => (\n              <Chip\n                key={value}\n                label={value}\n                className={classes.chip}\n                size=\"small\"\n              />\n            ))}\n          </div>\n        )}\n      >\n        {values.map((value: string) => (\n          <MenuItem key={value} value={value}>\n            <Checkbox checked={types.indexOf(value) > -1} />\n            <ListItemText primary={value} />\n          </MenuItem>\n        ))}\n      </Select>\n    </FormControl>\n  );\n};\n\n/**\n * A control surface for the search query's \"types\" property, displayed as a\n * single-select collapsible accordion suitable for use in faceted search UIs.\n * @public\n */\nSearchType.Accordion = (props: SearchTypeAccordionProps) => {\n  return <SearchTypeAccordion {...props} />;\n};\n\n/**\n * A control surface for the search query's \"types\" property, displayed as a\n * tabs suitable for use in faceted search UIs.\n * @public\n */\nSearchType.Tabs = (props: SearchTypeTabsProps) => {\n  return <SearchTypeTabs {...props} />;\n};\n\nexport { SearchType };\nexport type { SearchTypeAccordionProps, SearchTypeTabsProps };\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport qs from 'qs';\nimport React, { useCallback } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { rootRouteRef } from '../../plugin';\n\nimport { useRouteRef, IconComponent } from '@backstage/core-plugin-api';\nimport { SidebarSearchField, useContent } from '@backstage/core-components';\n\nexport type SidebarSearchProps = {\n  icon?: IconComponent;\n};\n\nexport const SidebarSearch = (props: SidebarSearchProps) => {\n  const searchRoute = useRouteRef(rootRouteRef);\n  const { focusContent } = useContent();\n  const navigate = useNavigate();\n  const handleSearch = useCallback(\n    (query: string): void => {\n      const queryString = qs.stringify({ query }, { addQueryPrefix: true });\n      focusContent();\n      navigate(`${searchRoute()}${queryString}`);\n    },\n    [focusContent, navigate, searchRoute],\n  );\n\n  return (\n    <SidebarSearchField\n      icon={props.icon}\n      onSearch={handleSearch}\n      to=\"/search\"\n    />\n  );\n};\n"],"names":["useStyles","FiltersButton","Filters","SearchBar","DefaultResultListItem","SearchPage","SearchResult","makeStyles","IconButton","InputBase"],"mappings":"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"}