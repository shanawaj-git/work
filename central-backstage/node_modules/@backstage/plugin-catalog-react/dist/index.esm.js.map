{"version":3,"file":"index.esm.js","sources":["../src/api.ts","../src/apis/StarredEntitiesApi/StarredEntitiesApi.ts","../src/apis/StarredEntitiesApi/MockStarredEntitiesApi.ts","../src/hooks/useEntity.tsx","../src/utils/filters.ts","../src/utils/getEntityMetadataUrl.ts","../src/utils/getEntityRelations.ts","../src/utils/getEntitySourceLocation.ts","../src/utils/isOwnerOf.ts","../src/hooks/useEntityListProvider.tsx","../src/routes.ts","../src/components/EntityRefLink/humanize.ts","../src/components/EntityRefLink/EntityRefLink.tsx","../src/components/EntityRefLink/EntityRefLinks.tsx","../src/filters.ts","../src/hooks/useEntityTypeFilter.tsx","../src/hooks/useRelatedEntities.ts","../src/hooks/useStarredEntities.ts","../src/hooks/useStarredEntity.ts","../src/hooks/useEntityOwnership.ts","../src/hooks/useEntityPermission.ts","../src/components/EntityKindPicker/EntityKindPicker.tsx","../src/components/EntityLifecyclePicker/EntityLifecyclePicker.tsx","../src/components/EntityOwnerPicker/EntityOwnerPicker.tsx","../src/components/EntitySearchBar/EntitySearchBar.tsx","../src/components/EntityTable/columns.tsx","../src/components/EntityTable/presets.tsx","../src/components/EntityTable/EntityTable.tsx","../src/components/EntityTagPicker/EntityTagPicker.tsx","../src/components/EntityTypePicker/EntityTypePicker.tsx","../src/components/FavoriteEntity/FavoriteEntity.tsx","../src/components/InspectEntityDialog/components/EntityKindIcon.tsx","../src/components/InspectEntityDialog/components/AncestryPage.tsx","../src/components/InspectEntityDialog/components/common.tsx","../src/components/InspectEntityDialog/components/ColocatedPage.tsx","../src/components/InspectEntityDialog/components/util.ts","../src/components/InspectEntityDialog/components/JsonPage.tsx","../src/components/InspectEntityDialog/components/OverviewPage.tsx","../src/components/InspectEntityDialog/components/YamlPage.tsx","../src/components/InspectEntityDialog/InspectEntityDialog.tsx","../src/components/UnregisterEntityDialog/useUnregisterEntityDialogState.ts","../src/components/UnregisterEntityDialog/UnregisterEntityDialog.tsx","../src/components/UserListPicker/UserListPicker.tsx","../src/testUtils/providers.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CatalogApi } from '@backstage/catalog-client';\nimport { createApiRef } from '@backstage/core-plugin-api';\n\n/**\n * The API reference for the {@link @backstage/catalog-client#CatalogApi}.\n * @public\n */\nexport const catalogApiRef = createApiRef<CatalogApi>({\n  id: 'plugin.catalog.service',\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, createApiRef } from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\n\n/**\n * An API to store starred entities\n *\n * @public\n */\nexport const starredEntitiesApiRef: ApiRef<StarredEntitiesApi> = createApiRef({\n  id: 'catalog-react.starred-entities',\n});\n\n/**\n * An API to store and retrieve starred entities\n *\n * @public\n */\nexport interface StarredEntitiesApi {\n  /**\n   * Toggle the star state of the entity\n   *\n   * @param entityRef - an entity reference to toggle\n   */\n  toggleStarred(entityRef: string): Promise<void>;\n\n  /**\n   * Observe the set of starred entity references.\n   */\n  starredEntitie$(): Observable<Set<string>>;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Observable } from '@backstage/types';\nimport ObservableImpl from 'zen-observable';\nimport { StarredEntitiesApi } from './StarredEntitiesApi';\n\n/**\n * An in-memory mock implementation of the StarredEntitiesApi.\n *\n * @public\n */\nexport class MockStarredEntitiesApi implements StarredEntitiesApi {\n  private readonly starredEntities = new Set<string>();\n  private readonly subscribers = new Set<\n    ZenObservable.SubscriptionObserver<Set<string>>\n  >();\n\n  private readonly observable = new ObservableImpl<Set<string>>(subscriber => {\n    subscriber.next(new Set(this.starredEntities));\n\n    this.subscribers.add(subscriber);\n    return () => {\n      this.subscribers.delete(subscriber);\n    };\n  });\n\n  async toggleStarred(entityRef: string): Promise<void> {\n    if (!this.starredEntities.delete(entityRef)) {\n      this.starredEntities.add(entityRef);\n    }\n\n    for (const subscription of this.subscribers) {\n      subscription.next(new Set(this.starredEntities));\n    }\n  }\n\n  starredEntitie$(): Observable<Set<string>> {\n    return this.observable;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Entity } from '@backstage/catalog-model';\nimport {\n  createVersionedContext,\n  createVersionedValueMap,\n  useVersionedContext,\n} from '@backstage/version-bridge';\nimport React, { ReactNode } from 'react';\n\n/** @public */\nexport type EntityLoadingStatus<TEntity extends Entity = Entity> = {\n  entity?: TEntity;\n  loading: boolean;\n  error?: Error;\n  refresh?: VoidFunction;\n};\n\n// This context has support for multiple concurrent versions of this package.\n// It is currently used in parallel with the old context in order to provide\n// a smooth transition, but will eventually be the only context we use.\nconst NewEntityContext =\n  createVersionedContext<{ 1: EntityLoadingStatus }>('entity-context');\n\n/**\n * Properties for the AsyncEntityProvider component.\n *\n * @public\n */\nexport interface AsyncEntityProviderProps {\n  children: ReactNode;\n  entity?: Entity;\n  loading: boolean;\n  error?: Error;\n  refresh?: VoidFunction;\n}\n\n/**\n * Provides a loaded entity to be picked up by the `useEntity` hook.\n *\n * @public\n */\nexport const AsyncEntityProvider = ({\n  children,\n  entity,\n  loading,\n  error,\n  refresh,\n}: AsyncEntityProviderProps) => {\n  const value = { entity, loading, error, refresh };\n  // We provide both the old and the new context, since\n  // consumers might be doing things like `useContext(EntityContext)`\n  return (\n    <NewEntityContext.Provider value={createVersionedValueMap({ 1: value })}>\n      {children}\n    </NewEntityContext.Provider>\n  );\n};\n\n/**\n * Properties for the EntityProvider component.\n *\n * @public\n */\nexport interface EntityProviderProps {\n  children: ReactNode;\n  entity?: Entity;\n}\n\n/**\n * Provides an entity to be picked up by the `useEntity` hook.\n *\n * @public\n */\nexport const EntityProvider = ({ entity, children }: EntityProviderProps) => (\n  <AsyncEntityProvider\n    entity={entity}\n    loading={!Boolean(entity)}\n    error={undefined}\n    refresh={undefined}\n    children={children}\n  />\n);\n\n/**\n * Grab the current entity from the context, throws if the entity has not yet been loaded\n * or is not available.\n *\n * @public\n */\nexport function useEntity<TEntity extends Entity = Entity>(): {\n  entity: TEntity;\n  /** @deprecated use {@link useAsyncEntity} instead */\n  loading: boolean;\n  /** @deprecated use {@link useAsyncEntity} instead */\n  error?: Error;\n  /** @deprecated use {@link useAsyncEntity} instead */\n  refresh?: VoidFunction;\n} {\n  const versionedHolder =\n    useVersionedContext<{ 1: EntityLoadingStatus }>('entity-context');\n\n  if (!versionedHolder) {\n    throw new Error('Entity context is not available');\n  }\n\n  const value = versionedHolder.atVersion(1);\n  if (!value) {\n    throw new Error('EntityContext v1 not available');\n  }\n\n  if (!value.entity) {\n    // Once we have removed the additional fields from being returned we can drop this deprecation\n    // and move to the error instead.\n    // throw new Error('useEntity hook is being called outside of an EntityLayout where the entity has not been loaded. If this is intentional, please use useAsyncEntity instead.');\n\n    // eslint-disable-next-line no-console\n    console.warn(\n      'DEPRECATION: useEntity hook is being called outside of an EntityLayout where the entity has not been loaded. If this is intentional, please use useAsyncEntity instead. This warning will be replaced with an error in future releases.',\n    );\n  }\n\n  const { entity, loading, error, refresh } = value;\n  return { entity: entity as TEntity, loading, error, refresh };\n}\n\n/**\n * Grab the current entity from the context, provides loading state and errors, and the ability to refresh.\n *\n * @public\n */\nexport function useAsyncEntity<\n  TEntity extends Entity = Entity,\n>(): EntityLoadingStatus<TEntity> {\n  const versionedHolder =\n    useVersionedContext<{ 1: EntityLoadingStatus }>('entity-context');\n\n  if (!versionedHolder) {\n    throw new Error('Entity context is not available');\n  }\n  const value = versionedHolder.atVersion(1);\n  if (!value) {\n    throw new Error('EntityContext v1 not available');\n  }\n\n  const { entity, loading, error, refresh } = value;\n  return { entity: entity as TEntity, loading, error, refresh };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { EntityFilter } from '../types';\n\nexport function reduceCatalogFilters(\n  filters: EntityFilter[],\n): Record<string, string | symbol | (string | symbol)[]> {\n  return filters.reduce((compoundFilter, filter) => {\n    return {\n      ...compoundFilter,\n      ...(filter.getCatalogFilters ? filter.getCatalogFilters() : {}),\n    };\n  }, {} as Record<string, string | symbol | (string | symbol)[]>);\n}\n\nexport function reduceEntityFilters(\n  filters: EntityFilter[],\n): (entity: Entity) => boolean {\n  return (entity: Entity) =>\n    filters.every(\n      filter => !filter.filterEntity || filter.filterEntity(entity),\n    );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ANNOTATION_EDIT_URL,\n  ANNOTATION_VIEW_URL,\n  Entity,\n} from '@backstage/catalog-model';\n\n/**\n * @public\n * @deprecated use entity.metadata.annotations?.[ANNOTATION_VIEW_URL] instead. */\nexport function getEntityMetadataViewUrl(entity: Entity): string | undefined {\n  return entity.metadata.annotations?.[ANNOTATION_VIEW_URL];\n}\n\n/**\n * @public\n * @deprecated use entity.metadata.annotations?.[ANNOTATION_EDIT_URL] instead.\n */\nexport function getEntityMetadataEditUrl(entity: Entity): string | undefined {\n  return entity.metadata.annotations?.[ANNOTATION_EDIT_URL];\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  parseEntityRef,\n} from '@backstage/catalog-model';\n\n// TODO(freben): This should be returning entity refs instead\n/**\n * Get the related entity references.\n *\n * @public\n */\nexport function getEntityRelations(\n  entity: Entity | undefined,\n  relationType: string,\n  filter?: { kind: string },\n): CompoundEntityRef[] {\n  let entityNames =\n    entity?.relations\n      ?.filter(r => r.type === relationType)\n      .map(r => parseEntityRef(r.targetRef)) || [];\n\n  if (filter?.kind) {\n    entityNames = entityNames.filter(\n      e =>\n        e.kind.toLocaleLowerCase('en-US') ===\n        filter.kind.toLocaleLowerCase('en-US'),\n    );\n  }\n\n  return entityNames;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ANNOTATION_SOURCE_LOCATION,\n  Entity,\n  parseLocationRef,\n} from '@backstage/catalog-model';\nimport { ScmIntegrationRegistry } from '@backstage/integration';\n\n/** @public */\nexport type EntitySourceLocation = {\n  locationTargetUrl: string;\n  integrationType?: string;\n};\n\n/** @public */\nexport function getEntitySourceLocation(\n  entity: Entity,\n  scmIntegrationsApi: ScmIntegrationRegistry,\n): EntitySourceLocation | undefined {\n  const sourceLocation =\n    entity.metadata.annotations?.[ANNOTATION_SOURCE_LOCATION];\n\n  if (!sourceLocation) {\n    return undefined;\n  }\n\n  try {\n    const sourceLocationRef = parseLocationRef(sourceLocation);\n    const integration = scmIntegrationsApi.byUrl(sourceLocationRef.target);\n    return {\n      locationTargetUrl: sourceLocationRef.target,\n      integrationType: integration?.type,\n    };\n  } catch {\n    return undefined;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  getCompoundEntityRef,\n  RELATION_MEMBER_OF,\n  RELATION_OWNED_BY,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { getEntityRelations } from './getEntityRelations';\n\n/**\n * Returns true if the `owner` argument is a direct owner on the `entity` argument.\n *\n * @alpha\n * @remarks\n *\n * Note that this ownership is not the same as using the claims in the auth-resolver, it only will take into account ownership as expressed by direct entity relations.\n * It doesn't know anything about the additional groups that a user might belong to which the claims contain.\n */\nexport function isOwnerOf(owner: Entity, entity: Entity) {\n  const possibleOwners = new Set(\n    [\n      ...getEntityRelations(owner, RELATION_MEMBER_OF, { kind: 'group' }),\n      ...(owner ? [getCompoundEntityRef(owner)] : []),\n    ].map(stringifyEntityRef),\n  );\n\n  const owners = getEntityRelations(entity, RELATION_OWNED_BY).map(\n    stringifyEntityRef,\n  );\n\n  for (const ownerItem of owners) {\n    if (possibleOwners.has(ownerItem)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { compact, isEqual } from 'lodash';\nimport qs from 'qs';\nimport React, {\n  createContext,\n  PropsWithChildren,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n} from 'react';\nimport { useLocation } from 'react-router';\nimport useAsyncFn from 'react-use/lib/useAsyncFn';\nimport useDebounce from 'react-use/lib/useDebounce';\nimport useMountedState from 'react-use/lib/useMountedState';\nimport { catalogApiRef } from '../api';\nimport {\n  EntityKindFilter,\n  EntityLifecycleFilter,\n  EntityOwnerFilter,\n  EntityTagFilter,\n  EntityTextFilter,\n  EntityTypeFilter,\n  UserListFilter,\n} from '../filters';\nimport { EntityFilter } from '../types';\nimport { reduceCatalogFilters, reduceEntityFilters } from '../utils';\nimport { useApi } from '@backstage/core-plugin-api';\n\n/** @public */\nexport type DefaultEntityFilters = {\n  kind?: EntityKindFilter;\n  type?: EntityTypeFilter;\n  user?: UserListFilter;\n  owners?: EntityOwnerFilter;\n  lifecycles?: EntityLifecycleFilter;\n  tags?: EntityTagFilter;\n  text?: EntityTextFilter;\n};\n\n/** @public */\nexport type EntityListContextProps<\n  EntityFilters extends DefaultEntityFilters = DefaultEntityFilters,\n> = {\n  /**\n   * The currently registered filters, adhering to the shape of DefaultEntityFilters or an extension\n   * of that default (to add custom filter types).\n   */\n  filters: EntityFilters;\n\n  /**\n   * The resolved list of catalog entities, after all filters are applied.\n   */\n  entities: Entity[];\n\n  /**\n   * The resolved list of catalog entities, after _only catalog-backend_ filters are applied.\n   */\n  backendEntities: Entity[];\n\n  /**\n   * Update one or more of the registered filters. Optional filters can be set to `undefined` to\n   * reset the filter.\n   */\n  updateFilters: (\n    filters:\n      | Partial<EntityFilters>\n      | ((prevFilters: EntityFilters) => Partial<EntityFilters>),\n  ) => void;\n\n  /**\n   * Filter values from query parameters.\n   */\n  queryParameters: Partial<Record<keyof EntityFilters, string | string[]>>;\n\n  loading: boolean;\n  error?: Error;\n};\n\n/**\n * Creates new context for entity listing and filtering.\n * @public\n */\nexport const EntityListContext = createContext<\n  EntityListContextProps<any> | undefined\n>(undefined);\n\ntype OutputState<EntityFilters extends DefaultEntityFilters> = {\n  appliedFilters: EntityFilters;\n  entities: Entity[];\n  backendEntities: Entity[];\n};\n\n/**\n * Provides entities and filters for a catalog listing.\n * @public\n */\nexport const EntityListProvider = <EntityFilters extends DefaultEntityFilters>({\n  children,\n}: PropsWithChildren<{}>) => {\n  const isMounted = useMountedState();\n  const catalogApi = useApi(catalogApiRef);\n  const [requestedFilters, setRequestedFilters] = useState<EntityFilters>(\n    {} as EntityFilters,\n  );\n\n  // We use react-router's useLocation hook so updates from external sources trigger an update to\n  // the queryParameters in outputState. Updates from this hook use replaceState below and won't\n  // trigger a useLocation change; this would instead come from an external source, such as a manual\n  // update of the URL or two catalog sidebar links with different catalog filters.\n  const location = useLocation();\n  const queryParameters = useMemo(\n    () =>\n      (qs.parse(location.search, {\n        ignoreQueryPrefix: true,\n      }).filters ?? {}) as Record<string, string | string[]>,\n    [location],\n  );\n\n  const [outputState, setOutputState] = useState<OutputState<EntityFilters>>(\n    () => {\n      return {\n        appliedFilters: {} as EntityFilters,\n        entities: [],\n        backendEntities: [],\n      };\n    },\n  );\n\n  // The main async filter worker. Note that while it has a lot of dependencies\n  // in terms of its implementation, the triggering only happens (debounced)\n  // based on the requested filters changing.\n  const [{ loading, error }, refresh] = useAsyncFn(\n    async () => {\n      const compacted = compact(Object.values(requestedFilters));\n      const entityFilter = reduceEntityFilters(compacted);\n      const backendFilter = reduceCatalogFilters(compacted);\n      const previousBackendFilter = reduceCatalogFilters(\n        compact(Object.values(outputState.appliedFilters)),\n      );\n\n      const queryParams = Object.keys(requestedFilters).reduce(\n        (params, key) => {\n          const filter: EntityFilter | undefined =\n            requestedFilters[key as keyof EntityFilters];\n          if (filter?.toQueryValue) {\n            params[key] = filter.toQueryValue();\n          }\n          return params;\n        },\n        {} as Record<string, string | string[]>,\n      );\n\n      // TODO(mtlewis): currently entities will never be requested unless\n      // there's at least one filter, we should allow an initial request\n      // to happen with no filters.\n      if (!isEqual(previousBackendFilter, backendFilter)) {\n        // TODO(timbonicus): should limit fields here, but would need filter\n        // fields + table columns\n        const response = await catalogApi.getEntities({\n          filter: backendFilter,\n        });\n        setOutputState({\n          appliedFilters: requestedFilters,\n          backendEntities: response.items,\n          entities: response.items.filter(entityFilter),\n        });\n      } else {\n        setOutputState({\n          appliedFilters: requestedFilters,\n          backendEntities: outputState.backendEntities,\n          entities: outputState.backendEntities.filter(entityFilter),\n        });\n      }\n\n      if (isMounted()) {\n        const oldParams = qs.parse(location.search, {\n          ignoreQueryPrefix: true,\n        });\n        const newParams = qs.stringify(\n          { ...oldParams, filters: queryParams },\n          { addQueryPrefix: true, arrayFormat: 'repeat' },\n        );\n        const newUrl = `${window.location.pathname}${newParams}`;\n        // We use direct history manipulation since useSearchParams and\n        // useNavigate in react-router-dom cause unnecessary extra rerenders.\n        // Also make sure to replace the state rather than pushing, since we\n        // don't want there to be back/forward slots for every single filter\n        // change.\n        window.history?.replaceState(null, document.title, newUrl);\n      }\n    },\n    [catalogApi, queryParameters, requestedFilters, outputState],\n    { loading: true },\n  );\n\n  // Slight debounce on the refresh, since (especially on page load) several\n  // filters will be calling this in rapid succession.\n  useDebounce(refresh, 10, [requestedFilters]);\n\n  const updateFilters = useCallback(\n    (\n      update:\n        | Partial<EntityFilter>\n        | ((prevFilters: EntityFilters) => Partial<EntityFilters>),\n    ) => {\n      setRequestedFilters(prevFilters => {\n        const newFilters =\n          typeof update === 'function' ? update(prevFilters) : update;\n        return { ...prevFilters, ...newFilters };\n      });\n    },\n    [],\n  );\n\n  const value = useMemo(\n    () => ({\n      filters: outputState.appliedFilters,\n      entities: outputState.entities,\n      backendEntities: outputState.backendEntities,\n      updateFilters,\n      queryParameters,\n      loading,\n      error,\n    }),\n    [outputState, updateFilters, queryParameters, loading, error],\n  );\n\n  return (\n    <EntityListContext.Provider value={value}>\n      {children}\n    </EntityListContext.Provider>\n  );\n};\n\n/**\n * Hook for interacting with the entity list context provided by the {@link EntityListProvider}.\n * @public\n */\nexport function useEntityList<\n  EntityFilters extends DefaultEntityFilters = DefaultEntityFilters,\n>(): EntityListContextProps<EntityFilters> {\n  const context = useContext(EntityListContext);\n  if (!context)\n    throw new Error('useEntityList must be used within EntityListProvider');\n  return context;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity, DEFAULT_NAMESPACE } from '@backstage/catalog-model';\nimport { createRouteRef } from '@backstage/core-plugin-api';\nimport { getOrCreateGlobalSingleton } from '@backstage/version-bridge';\n\n/**\n * A stable route ref that points to the catalog page for an individual entity.\n *\n * This `RouteRef` can be imported and used directly, and does not need to be referenced\n * via an `ExternalRouteRef`.\n *\n * If you want to replace the `EntityPage` from `@backstage/catalog-plugin` in your app,\n * you need to use the `entityRouteRef` as the mount point instead of your own.\n * @public\n */\nexport const entityRouteRef = getOrCreateGlobalSingleton(\n  'catalog:entity-route-ref',\n  () =>\n    createRouteRef({\n      id: 'catalog:entity',\n      params: ['namespace', 'kind', 'name'],\n    }),\n);\n\n/**\n * Utility function to get suitable route params for entityRoute, given an\n * @public\n */\nexport function entityRouteParams(entity: Entity) {\n  return {\n    kind: entity.kind.toLocaleLowerCase('en-US'),\n    namespace:\n      entity.metadata.namespace?.toLocaleLowerCase('en-US') ??\n      DEFAULT_NAMESPACE,\n    name: entity.metadata.name,\n  } as const;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  DEFAULT_NAMESPACE,\n} from '@backstage/catalog-model';\n\n/** @public @deprecated please use {@link humanizeEntityRef} instead */\nexport const formatEntityRefTitle = humanizeEntityRef;\n\n/** @public */\nexport function humanizeEntityRef(\n  entityRef: Entity | CompoundEntityRef,\n  opts?: { defaultKind?: string },\n) {\n  const defaultKind = opts?.defaultKind;\n  let kind;\n  let namespace;\n  let name;\n\n  if ('metadata' in entityRef) {\n    kind = entityRef.kind;\n    namespace = entityRef.metadata.namespace;\n    name = entityRef.metadata.name;\n  } else {\n    kind = entityRef.kind;\n    namespace = entityRef.namespace;\n    name = entityRef.name;\n  }\n\n  if (namespace === DEFAULT_NAMESPACE) {\n    namespace = undefined;\n  }\n\n  kind = kind.toLocaleLowerCase('en-US');\n  kind =\n    defaultKind && defaultKind.toLocaleLowerCase('en-US') === kind\n      ? undefined\n      : kind;\n  return `${kind ? `${kind}:` : ''}${namespace ? `${namespace}/` : ''}${name}`;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  DEFAULT_NAMESPACE,\n  parseEntityRef,\n} from '@backstage/catalog-model';\nimport React, { forwardRef } from 'react';\nimport { entityRouteRef } from '../../routes';\nimport { humanizeEntityRef } from './humanize';\nimport { Link, LinkProps } from '@backstage/core-components';\nimport { useRouteRef } from '@backstage/core-plugin-api';\nimport { Tooltip } from '@material-ui/core';\n\n/**\n * Props for {@link EntityRefLink}.\n *\n * @public\n */\nexport type EntityRefLinkProps = {\n  entityRef: Entity | CompoundEntityRef | string;\n  defaultKind?: string;\n  title?: string;\n  children?: React.ReactNode;\n} & Omit<LinkProps, 'to'>;\n\n/**\n * Shows a clickable link to an entity.\n *\n * @public\n */\nexport const EntityRefLink = forwardRef<any, EntityRefLinkProps>(\n  (props, ref) => {\n    const { entityRef, defaultKind, title, children, ...linkProps } = props;\n    const entityRoute = useRouteRef(entityRouteRef);\n\n    let kind;\n    let namespace;\n    let name;\n\n    if (typeof entityRef === 'string') {\n      const parsed = parseEntityRef(entityRef);\n      kind = parsed.kind;\n      namespace = parsed.namespace;\n      name = parsed.name;\n    } else if ('metadata' in entityRef) {\n      kind = entityRef.kind;\n      namespace = entityRef.metadata.namespace;\n      name = entityRef.metadata.name;\n    } else {\n      kind = entityRef.kind;\n      namespace = entityRef.namespace;\n      name = entityRef.name;\n    }\n\n    kind = kind.toLocaleLowerCase('en-US');\n    namespace = namespace?.toLocaleLowerCase('en-US') ?? DEFAULT_NAMESPACE;\n\n    const routeParams = { kind, namespace, name };\n    const formattedEntityRefTitle = humanizeEntityRef(\n      { kind, namespace, name },\n      { defaultKind },\n    );\n\n    const link = (\n      <Link {...linkProps} ref={ref} to={entityRoute(routeParams)}>\n        {children}\n        {!children && (title ?? formattedEntityRefTitle)}\n      </Link>\n    );\n\n    return title ? (\n      <Tooltip title={formattedEntityRefTitle}>{link}</Tooltip>\n    ) : (\n      link\n    );\n  },\n) as (props: EntityRefLinkProps) => JSX.Element;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity, CompoundEntityRef } from '@backstage/catalog-model';\nimport React from 'react';\nimport { EntityRefLink } from './EntityRefLink';\nimport { LinkProps } from '@backstage/core-components';\n\n/**\n * Props for {@link EntityRefLink}.\n *\n * @public\n */\nexport type EntityRefLinksProps = {\n  entityRefs: (Entity | CompoundEntityRef)[];\n  defaultKind?: string;\n} & Omit<LinkProps, 'to'>;\n\n/**\n * Shows a list of clickable links to entities.\n *\n * @public\n */\nexport const EntityRefLinks = ({\n  entityRefs,\n  defaultKind,\n  ...linkProps\n}: EntityRefLinksProps) => (\n  <>\n    {entityRefs.map((r, i) => (\n      <React.Fragment key={i}>\n        {i > 0 && ', '}\n        <EntityRefLink {...linkProps} entityRef={r} defaultKind={defaultKind} />\n      </React.Fragment>\n    ))}\n  </>\n);\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity, RELATION_OWNED_BY } from '@backstage/catalog-model';\nimport { humanizeEntityRef } from './components/EntityRefLink';\nimport { EntityFilter, UserListFilterKind } from './types';\nimport { getEntityRelations } from './utils';\n\n/**\n * Filter entities based on Kind.\n * @public\n */\nexport class EntityKindFilter implements EntityFilter {\n  constructor(readonly value: string) {}\n\n  getCatalogFilters(): Record<string, string | string[]> {\n    return { kind: this.value };\n  }\n\n  toQueryValue(): string {\n    return this.value;\n  }\n}\n\n/**\n * Filters entities based on type\n * @public\n */\nexport class EntityTypeFilter implements EntityFilter {\n  constructor(readonly value: string | string[]) {}\n\n  // Simplify `string | string[]` for consumers, always returns an array\n  getTypes(): string[] {\n    return Array.isArray(this.value) ? this.value : [this.value];\n  }\n\n  getCatalogFilters(): Record<string, string | string[]> {\n    return { 'spec.type': this.getTypes() };\n  }\n\n  toQueryValue(): string[] {\n    return this.getTypes();\n  }\n}\n\n/**\n * Filters entities based on tag.\n * @public\n */\nexport class EntityTagFilter implements EntityFilter {\n  constructor(readonly values: string[]) {}\n\n  filterEntity(entity: Entity): boolean {\n    return this.values.every(v => (entity.metadata.tags ?? []).includes(v));\n  }\n\n  toQueryValue(): string[] {\n    return this.values;\n  }\n}\n\n/**\n * Filters entities where the text matches spec, title or tags.\n * @public\n */\nexport class EntityTextFilter implements EntityFilter {\n  constructor(readonly value: string) {}\n\n  filterEntity(entity: Entity): boolean {\n    const upperCaseValue = this.value.toLocaleUpperCase('en-US');\n\n    return (\n      entity.metadata.name\n        .toLocaleUpperCase('en-US')\n        .includes(upperCaseValue) ||\n      `${entity.metadata.title}`\n        .toLocaleUpperCase('en-US')\n        .includes(upperCaseValue) ||\n      entity.metadata.tags\n        ?.join('')\n        .toLocaleUpperCase('en-US')\n        .indexOf(upperCaseValue) !== -1\n    );\n  }\n}\n\n/**\n * Filter matching entities that are owned by group.\n * @public\n */\nexport class EntityOwnerFilter implements EntityFilter {\n  constructor(readonly values: string[]) {}\n\n  filterEntity(entity: Entity): boolean {\n    return this.values.some(v =>\n      getEntityRelations(entity, RELATION_OWNED_BY).some(\n        o => humanizeEntityRef(o, { defaultKind: 'group' }) === v,\n      ),\n    );\n  }\n\n  toQueryValue(): string[] {\n    return this.values;\n  }\n}\n\n/**\n * Filters entities on lifecycle.\n * @public\n */\nexport class EntityLifecycleFilter implements EntityFilter {\n  constructor(readonly values: string[]) {}\n\n  filterEntity(entity: Entity): boolean {\n    return this.values.some(v => entity.spec?.lifecycle === v);\n  }\n\n  toQueryValue(): string[] {\n    return this.values;\n  }\n}\n\n/**\n * Filters entities based on whatever the user has starred or owns them.\n * @public\n */\nexport class UserListFilter implements EntityFilter {\n  constructor(\n    readonly value: UserListFilterKind,\n    readonly isOwnedEntity: (entity: Entity) => boolean,\n    readonly isStarredEntity: (entity: Entity) => boolean,\n  ) {}\n\n  filterEntity(entity: Entity): boolean {\n    switch (this.value) {\n      case 'owned':\n        return this.isOwnedEntity(entity);\n      case 'starred':\n        return this.isStarredEntity(entity);\n      default:\n        return true;\n    }\n  }\n\n  toQueryValue(): string {\n    return this.value;\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\nimport isEqual from 'lodash/isEqual';\nimport sortBy from 'lodash/sortBy';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { catalogApiRef } from '../api';\nimport { useEntityList } from './useEntityListProvider';\nimport { EntityTypeFilter } from '../filters';\n\n/**\n * A hook built on top of `useEntityList` for enabling selection of valid `spec.type` values\n * based on the selected EntityKindFilter.\n * @public\n */\nexport function useEntityTypeFilter(): {\n  loading: boolean;\n  error?: Error;\n  availableTypes: string[];\n  selectedTypes: string[];\n  setSelectedTypes: (types: string[]) => void;\n} {\n  const catalogApi = useApi(catalogApiRef);\n  const {\n    filters: { kind: kindFilter, type: typeFilter },\n    queryParameters,\n    updateFilters,\n  } = useEntityList();\n\n  const queryParamTypes = useMemo(\n    () => [queryParameters.type].flat().filter(Boolean) as string[],\n    [queryParameters],\n  );\n\n  const [selectedTypes, setSelectedTypes] = useState(\n    queryParamTypes.length ? queryParamTypes : typeFilter?.getTypes() ?? [],\n  );\n\n  // Set selected types on query parameter updates; this happens at initial page load and from\n  // external updates to the page location.\n  useEffect(() => {\n    if (queryParamTypes.length) {\n      setSelectedTypes(queryParamTypes);\n    }\n  }, [queryParamTypes]);\n\n  const [availableTypes, setAvailableTypes] = useState<string[]>([]);\n  const kind = useMemo(() => kindFilter?.value, [kindFilter]);\n\n  // Load all valid spec.type values straight from the catalogApi, paying attention to only the\n  // kind filter for a complete list.\n  const {\n    error,\n    loading,\n    value: facets,\n  } = useAsync(async () => {\n    if (kind) {\n      const items = await catalogApi\n        .getEntityFacets({\n          filter: { kind },\n          facets: ['spec.type'],\n        })\n        .then(response => response.facets['spec.type'] || []);\n      return items;\n    }\n    return [];\n  }, [kind, catalogApi]);\n\n  const facetsRef = useRef(facets);\n  useEffect(() => {\n    const oldFacets = facetsRef.current;\n    facetsRef.current = facets;\n    // Delay processing hook until kind and facets load updates have settled to generate list of types;\n    // This prevents resetting the type filter due to saved type value from query params not matching the\n    // empty set of type values while values are still being loaded; also only run this hook on changes\n    // to facets\n    if (loading || !kind || oldFacets === facets || !facets) {\n      return;\n    }\n\n    // Sort by facet count descending, so the most common types appear on top\n    const newTypes = sortBy(facets, f => -f.count).map(f => f.value);\n    setAvailableTypes(newTypes);\n\n    // Update type filter to only valid values when the list of available types has changed\n    const stillValidTypes = selectedTypes.filter(value =>\n      newTypes.includes(value),\n    );\n    if (!isEqual(selectedTypes, stillValidTypes)) {\n      setSelectedTypes(stillValidTypes);\n    }\n  }, [loading, kind, selectedTypes, setSelectedTypes, facets]);\n\n  useEffect(() => {\n    updateFilters({\n      type: selectedTypes.length\n        ? new EntityTypeFilter(selectedTypes)\n        : undefined,\n    });\n  }, [selectedTypes, updateFilters]);\n\n  return {\n    loading,\n    error,\n    availableTypes,\n    selectedTypes,\n    setSelectedTypes,\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Entity, parseEntityRef } from '@backstage/catalog-model';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { chunk, groupBy } from 'lodash';\nimport useAsync from 'react-use/lib/useAsync';\nimport { catalogApiRef } from '../api';\n\nconst BATCH_SIZE = 20;\n\n/** @public */\nexport function useRelatedEntities(\n  entity: Entity,\n  relationFilter: { type?: string; kind?: string },\n): {\n  entities: Entity[] | undefined;\n  loading: boolean;\n  error: Error | undefined;\n} {\n  const filterByTypeLower = relationFilter?.type?.toLocaleLowerCase('en-US');\n  const filterByKindLower = relationFilter?.kind?.toLocaleLowerCase('en-US');\n\n  const catalogApi = useApi(catalogApiRef);\n  const {\n    loading,\n    value: entities,\n    error,\n  } = useAsync(async () => {\n    const relations = entity.relations\n      ?.map(r => ({ type: r.type, target: parseEntityRef(r.targetRef) }))\n      .filter(\n        r =>\n          (!filterByTypeLower ||\n            r.type.toLocaleLowerCase('en-US') === filterByTypeLower) &&\n          (!filterByKindLower || r.target.kind === filterByKindLower),\n      );\n\n    if (!relations) {\n      return [];\n    }\n\n    // Group the relations by kind and namespace to reduce the size of the request query string.\n    // Without this grouping, the kind and namespace would need to be specified for each relation, e.g.\n    // `filter=kind=component,namespace=default,name=example1&filter=kind=component,namespace=default,name=example2`\n    // with grouping, we can generate a query a string like\n    // `filter=kind=component,namespace=default,name=example1,example2`\n    const relationsByKindAndNamespace = Object.values(\n      groupBy(relations, ({ target }) => {\n        return `${target.kind}:${target.namespace}`.toLocaleLowerCase('en-US');\n      }),\n    );\n\n    // Split the names within each group into batches to further reduce the query string length.\n    const batchedRelationsByKindAndNamespace: {\n      kind: string;\n      namespace: string;\n      nameBatches: string[][];\n    }[] = [];\n    for (const rs of relationsByKindAndNamespace) {\n      batchedRelationsByKindAndNamespace.push({\n        // All relations in a group have the same kind and namespace, so its arbitrary which we pick\n        kind: rs[0].target.kind,\n        namespace: rs[0].target.namespace,\n        nameBatches: chunk(\n          rs.map(r => r.target.name),\n          BATCH_SIZE,\n        ),\n      });\n    }\n\n    const results = await Promise.all(\n      batchedRelationsByKindAndNamespace.flatMap(rs => {\n        return rs.nameBatches.map(names => {\n          return catalogApi.getEntities({\n            filter: {\n              kind: rs.kind,\n              'metadata.namespace': rs.namespace,\n              'metadata.name': names,\n            },\n          });\n        });\n      }),\n    );\n\n    return results.flatMap(r => r.items);\n  }, [entity, filterByTypeLower, filterByKindLower]);\n\n  return {\n    entities,\n    loading,\n    error,\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { useCallback } from 'react';\nimport useObservable from 'react-use/lib/useObservable';\nimport { starredEntitiesApiRef } from '../apis';\n\nfunction getEntityRef(\n  entityOrRef: Entity | CompoundEntityRef | string,\n): string {\n  return typeof entityOrRef === 'string'\n    ? entityOrRef\n    : stringifyEntityRef(entityOrRef);\n}\n\n/** @public */\nexport function useStarredEntities(): {\n  starredEntities: Set<string>;\n  toggleStarredEntity: (\n    entityOrRef: Entity | CompoundEntityRef | string,\n  ) => void;\n  isStarredEntity: (\n    entityOrRef: Entity | CompoundEntityRef | string,\n  ) => boolean;\n} {\n  const starredEntitiesApi = useApi(starredEntitiesApiRef);\n\n  const starredEntities = useObservable(\n    starredEntitiesApi.starredEntitie$(),\n    new Set<string>(),\n  );\n\n  const isStarredEntity = useCallback(\n    (entityOrRef: Entity | CompoundEntityRef | string) =>\n      starredEntities.has(getEntityRef(entityOrRef)),\n    [starredEntities],\n  );\n\n  const toggleStarredEntity = useCallback(\n    (entityOrRef: Entity | CompoundEntityRef | string) =>\n      starredEntitiesApi.toggleStarred(getEntityRef(entityOrRef)).then(),\n    [starredEntitiesApi],\n  );\n\n  return {\n    starredEntities,\n    toggleStarredEntity,\n    isStarredEntity,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { useCallback, useEffect, useState } from 'react';\nimport { starredEntitiesApiRef } from '../apis';\n\nfunction getEntityRef(\n  entityOrRef: Entity | CompoundEntityRef | string,\n): string {\n  return typeof entityOrRef === 'string'\n    ? entityOrRef\n    : stringifyEntityRef(entityOrRef);\n}\n\n/** @public */\nexport function useStarredEntity(\n  entityOrRef: Entity | CompoundEntityRef | string,\n): {\n  toggleStarredEntity: () => void;\n  isStarredEntity: boolean;\n} {\n  const starredEntitiesApi = useApi(starredEntitiesApiRef);\n\n  const [isStarredEntity, setIsStarredEntity] = useState(false);\n\n  useEffect(() => {\n    const subscription = starredEntitiesApi.starredEntitie$().subscribe({\n      next(starredEntities: Set<string>) {\n        setIsStarredEntity(starredEntities.has(getEntityRef(entityOrRef)));\n      },\n    });\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [entityOrRef, starredEntitiesApi]);\n\n  const toggleStarredEntity = useCallback(\n    () => starredEntitiesApi.toggleStarred(getEntityRef(entityOrRef)).then(),\n    [entityOrRef, starredEntitiesApi],\n  );\n\n  return {\n    toggleStarredEntity,\n    isStarredEntity,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  RELATION_OWNED_BY,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { identityApiRef, useApi } from '@backstage/core-plugin-api';\nimport { useMemo } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\nimport { getEntityRelations } from '../utils/getEntityRelations';\n\n/**\n * Returns a function that checks whether the currently signed-in user is an\n * owner of a given entity. When the hook is initially mounted, the loading\n * flag will be true and the results returned from the function will always be\n * false.\n *\n * @public\n *\n * @returns a function that checks if the signed in user owns an entity\n */\nexport function useEntityOwnership(): {\n  loading: boolean;\n  isOwnedEntity: (entity: Entity) => boolean;\n} {\n  const identityApi = useApi(identityApiRef);\n\n  // Trigger load only on mount\n  const { loading, value: refs } = useAsync(async () => {\n    const { ownershipEntityRefs } = await identityApi.getBackstageIdentity();\n    return ownershipEntityRefs;\n  }, []);\n\n  const isOwnedEntity = useMemo(() => {\n    const myOwnerRefs = new Set(refs ?? []);\n    return (entity: Entity) => {\n      const entityOwnerRefs = getEntityRelations(entity, RELATION_OWNED_BY).map(\n        stringifyEntityRef,\n      );\n      for (const ref of entityOwnerRefs) {\n        if (myOwnerRefs.has(ref)) {\n          return true;\n        }\n      }\n      return false;\n    };\n  }, [refs]);\n\n  return useMemo(() => ({ loading, isOwnedEntity }), [loading, isOwnedEntity]);\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringifyEntityRef } from '@backstage/catalog-model';\nimport { Permission } from '@backstage/plugin-permission-common';\nimport { usePermission } from '@backstage/plugin-permission-react';\nimport { useEntity } from './useEntity';\n\n/**\n * A thin wrapper around the\n * {@link @backstage/plugin-permission-react#usePermission} hook which uses the\n * current entity in context to make an authorization request for the given\n * permission.\n *\n * Note: this hook blocks the permission request until the entity has loaded in\n * context. If you have the entityRef and need concurrent requests, use the\n * `usePermission` hook directly.\n * @alpha\n */\nexport function useEntityPermission(permission: Permission): {\n  loading: boolean;\n  allowed: boolean;\n  error?: Error;\n} {\n  const { entity, loading: loadingEntity, error: entityError } = useEntity();\n  const {\n    allowed,\n    loading: loadingPermission,\n    error: permissionError,\n  } = usePermission(\n    permission,\n    entity ? stringifyEntityRef(entity) : undefined,\n  );\n\n  if (loadingEntity || loadingPermission) {\n    return { loading: true, allowed: false };\n  }\n  if (entityError) {\n    return { loading: false, allowed: false, error: entityError };\n  }\n  return { loading: false, allowed, error: permissionError };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { Alert } from '@material-ui/lab';\nimport { useEntityList } from '../../hooks';\nimport { EntityKindFilter } from '../../filters';\n\n/**\n * Props for {@link EntityKindPicker}.\n *\n * @public\n */\nexport interface EntityKindPickerProps {\n  initialFilter?: string;\n  hidden: boolean;\n}\n\n/** @public */\nexport const EntityKindPicker = (props: EntityKindPickerProps) => {\n  const { initialFilter, hidden } = props;\n\n  const { updateFilters, queryParameters } = useEntityList();\n  const [selectedKind] = useState(\n    [queryParameters.kind].flat()[0] ?? initialFilter,\n  );\n\n  useEffect(() => {\n    updateFilters({\n      kind: selectedKind ? new EntityKindFilter(selectedKind) : undefined,\n    });\n  }, [selectedKind, updateFilters]);\n\n  if (hidden) return null;\n\n  // TODO(timbonicus): This should load available kinds from the catalog-backend, similar to\n  // EntityTypePicker.\n\n  return <Alert severity=\"warning\">Kind filter not yet available</Alert>;\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport {\n  Box,\n  Checkbox,\n  FormControlLabel,\n  makeStyles,\n  TextField,\n  Typography,\n} from '@material-ui/core';\nimport CheckBoxIcon from '@material-ui/icons/CheckBox';\nimport CheckBoxOutlineBlankIcon from '@material-ui/icons/CheckBoxOutlineBlank';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport { Autocomplete } from '@material-ui/lab';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useEntityList } from '../../hooks/useEntityListProvider';\nimport { EntityLifecycleFilter } from '../../filters';\n\n/** @public */\nexport type CatalogReactEntityLifecyclePickerClassKey = 'input';\n\nconst useStyles = makeStyles(\n  {\n    input: {},\n  },\n  {\n    name: 'CatalogReactEntityLifecyclePicker',\n  },\n);\n\nconst icon = <CheckBoxOutlineBlankIcon fontSize=\"small\" />;\nconst checkedIcon = <CheckBoxIcon fontSize=\"small\" />;\n\n/** @public */\nexport const EntityLifecyclePicker = () => {\n  const classes = useStyles();\n  const { updateFilters, backendEntities, filters, queryParameters } =\n    useEntityList();\n\n  const queryParamLifecycles = useMemo(\n    () => [queryParameters.lifecycles].flat().filter(Boolean) as string[],\n    [queryParameters],\n  );\n\n  const [selectedLifecycles, setSelectedLifecycles] = useState(\n    queryParamLifecycles.length\n      ? queryParamLifecycles\n      : filters.lifecycles?.values ?? [],\n  );\n\n  // Set selected lifecycles on query parameter updates; this happens at initial page load and from\n  // external updates to the page location.\n  useEffect(() => {\n    if (queryParamLifecycles.length) {\n      setSelectedLifecycles(queryParamLifecycles);\n    }\n  }, [queryParamLifecycles]);\n\n  useEffect(() => {\n    updateFilters({\n      lifecycles: selectedLifecycles.length\n        ? new EntityLifecycleFilter(selectedLifecycles)\n        : undefined,\n    });\n  }, [selectedLifecycles, updateFilters]);\n\n  const availableLifecycles = useMemo(\n    () =>\n      [\n        ...new Set(\n          backendEntities\n            .map((e: Entity) => e.spec?.lifecycle)\n            .filter(Boolean) as string[],\n        ),\n      ].sort(),\n    [backendEntities],\n  );\n\n  if (!availableLifecycles.length) return null;\n\n  return (\n    <Box pb={1} pt={1}>\n      <Typography variant=\"button\">Lifecycle</Typography>\n      <Autocomplete\n        aria-label=\"Lifecycle\"\n        multiple\n        options={availableLifecycles}\n        value={selectedLifecycles}\n        onChange={(_: object, value: string[]) => setSelectedLifecycles(value)}\n        renderOption={(option, { selected }) => (\n          <FormControlLabel\n            control={\n              <Checkbox\n                icon={icon}\n                checkedIcon={checkedIcon}\n                checked={selected}\n              />\n            }\n            label={option}\n          />\n        )}\n        size=\"small\"\n        popupIcon={<ExpandMoreIcon data-testid=\"lifecycle-picker-expand\" />}\n        renderInput={params => (\n          <TextField {...params} className={classes.input} variant=\"outlined\" />\n        )}\n      />\n    </Box>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity, RELATION_OWNED_BY } from '@backstage/catalog-model';\nimport {\n  Box,\n  Checkbox,\n  FormControlLabel,\n  makeStyles,\n  TextField,\n  Typography,\n} from '@material-ui/core';\nimport CheckBoxIcon from '@material-ui/icons/CheckBox';\nimport CheckBoxOutlineBlankIcon from '@material-ui/icons/CheckBoxOutlineBlank';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport { Autocomplete } from '@material-ui/lab';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useEntityList } from '../../hooks/useEntityListProvider';\nimport { EntityOwnerFilter } from '../../filters';\nimport { getEntityRelations } from '../../utils';\nimport { humanizeEntityRef } from '../EntityRefLink';\n\n/** @public */\nexport type CatalogReactEntityOwnerPickerClassKey = 'input';\n\nconst useStyles = makeStyles(\n  {\n    input: {},\n  },\n  {\n    name: 'CatalogReactEntityOwnerPicker',\n  },\n);\n\nconst icon = <CheckBoxOutlineBlankIcon fontSize=\"small\" />;\nconst checkedIcon = <CheckBoxIcon fontSize=\"small\" />;\n\n/** @public */\nexport const EntityOwnerPicker = () => {\n  const classes = useStyles();\n  const { updateFilters, backendEntities, filters, queryParameters } =\n    useEntityList();\n\n  const queryParamOwners = useMemo(\n    () => [queryParameters.owners].flat().filter(Boolean) as string[],\n    [queryParameters],\n  );\n\n  const [selectedOwners, setSelectedOwners] = useState(\n    queryParamOwners.length ? queryParamOwners : filters.owners?.values ?? [],\n  );\n\n  // Set selected owners on query parameter updates; this happens at initial page load and from\n  // external updates to the page location.\n  useEffect(() => {\n    if (queryParamOwners.length) {\n      setSelectedOwners(queryParamOwners);\n    }\n  }, [queryParamOwners]);\n\n  useEffect(() => {\n    updateFilters({\n      owners: selectedOwners.length\n        ? new EntityOwnerFilter(selectedOwners)\n        : undefined,\n    });\n  }, [selectedOwners, updateFilters]);\n\n  const availableOwners = useMemo(\n    () =>\n      [\n        ...new Set(\n          backendEntities\n            .flatMap((e: Entity) =>\n              getEntityRelations(e, RELATION_OWNED_BY).map(o =>\n                humanizeEntityRef(o, { defaultKind: 'group' }),\n              ),\n            )\n            .filter(Boolean) as string[],\n        ),\n      ].sort(),\n    [backendEntities],\n  );\n\n  if (!availableOwners.length) return null;\n\n  return (\n    <Box pb={1} pt={1}>\n      <Typography variant=\"button\">Owner</Typography>\n      <Autocomplete\n        multiple\n        aria-label=\"Owner\"\n        options={availableOwners}\n        value={selectedOwners}\n        onChange={(_: object, value: string[]) => setSelectedOwners(value)}\n        renderOption={(option, { selected }) => (\n          <FormControlLabel\n            control={\n              <Checkbox\n                icon={icon}\n                checkedIcon={checkedIcon}\n                checked={selected}\n              />\n            }\n            label={option}\n          />\n        )}\n        size=\"small\"\n        popupIcon={<ExpandMoreIcon data-testid=\"owner-picker-expand\" />}\n        renderInput={params => (\n          <TextField {...params} className={classes.input} variant=\"outlined\" />\n        )}\n      />\n    </Box>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FormControl,\n  IconButton,\n  Input,\n  InputAdornment,\n  makeStyles,\n  Toolbar,\n} from '@material-ui/core';\nimport Clear from '@material-ui/icons/Clear';\nimport Search from '@material-ui/icons/Search';\nimport React, { useState } from 'react';\nimport useDebounce from 'react-use/lib/useDebounce';\nimport { useEntityList } from '../../hooks/useEntityListProvider';\nimport { EntityTextFilter } from '../../filters';\n\n/** @public */\nexport type CatalogReactEntitySearchBarClassKey = 'searchToolbar' | 'input';\n\nconst useStyles = makeStyles(\n  _theme => ({\n    searchToolbar: {\n      paddingLeft: 0,\n      paddingRight: 0,\n    },\n    input: {},\n  }),\n  {\n    name: 'CatalogReactEntitySearchBar',\n  },\n);\n\n/**\n * Renders search bar for filtering the entity list.\n * @public\n */\nexport const EntitySearchBar = () => {\n  const classes = useStyles();\n\n  const { filters, updateFilters } = useEntityList();\n  const [search, setSearch] = useState(filters.text?.value ?? '');\n\n  useDebounce(\n    () => {\n      updateFilters({\n        text: search.length ? new EntityTextFilter(search) : undefined,\n      });\n    },\n    250,\n    [search, updateFilters],\n  );\n\n  return (\n    <Toolbar className={classes.searchToolbar}>\n      <FormControl>\n        <Input\n          id=\"input-with-icon-adornment\"\n          className={classes.input}\n          placeholder=\"Search\"\n          autoComplete=\"off\"\n          onChange={event => setSearch(event.target.value)}\n          value={search}\n          startAdornment={\n            <InputAdornment position=\"start\">\n              <Search />\n            </InputAdornment>\n          }\n          endAdornment={\n            <InputAdornment position=\"end\">\n              <IconButton\n                aria-label=\"clear search\"\n                onClick={() => setSearch('')}\n                edge=\"end\"\n                disabled={search.length === 0}\n              >\n                <Clear />\n              </IconButton>\n            </InputAdornment>\n          }\n        />\n      </FormControl>\n    </Toolbar>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  RELATION_OWNED_BY,\n  RELATION_PART_OF,\n} from '@backstage/catalog-model';\nimport { OverflowTooltip, TableColumn } from '@backstage/core-components';\nimport React from 'react';\nimport { getEntityRelations } from '../../utils';\nimport {\n  EntityRefLink,\n  EntityRefLinks,\n  humanizeEntityRef,\n} from '../EntityRefLink';\n\n/** @public */\nexport const columnFactories = Object.freeze({\n  createEntityRefColumn<T extends Entity>(options: {\n    defaultKind?: string;\n  }): TableColumn<T> {\n    const { defaultKind } = options;\n    function formatContent(entity: T): string {\n      return (\n        entity.metadata?.title ||\n        humanizeEntityRef(entity, {\n          defaultKind,\n        })\n      );\n    }\n\n    return {\n      title: 'Name',\n      highlight: true,\n      customFilterAndSearch(filter, entity) {\n        // TODO: We could implement this more efficiently, like searching over\n        // each field that is displayed individually (kind, namespace, name).\n        // but that might confuse the user as it will behave different than a\n        // simple text search.\n        // Another alternative would be to cache the values. But writing them\n        // into the entity feels bad too.\n        return formatContent(entity).includes(filter);\n      },\n      customSort(entity1, entity2) {\n        // TODO: We could implement this more efficiently by comparing field by field.\n        // This has similar issues as above.\n        return formatContent(entity1).localeCompare(formatContent(entity2));\n      },\n      render: entity => (\n        <EntityRefLink\n          entityRef={entity}\n          defaultKind={defaultKind}\n          title={entity.metadata?.title}\n        />\n      ),\n    };\n  },\n  createEntityRelationColumn<T extends Entity>({\n    title,\n    relation,\n    defaultKind,\n    filter: entityFilter,\n  }: {\n    title: string;\n    relation: string;\n    defaultKind?: string;\n    filter?: { kind: string };\n  }): TableColumn<T> {\n    function getRelations(entity: T): CompoundEntityRef[] {\n      return getEntityRelations(entity, relation, entityFilter);\n    }\n\n    function formatContent(entity: T): string {\n      return getRelations(entity)\n        .map(r => humanizeEntityRef(r, { defaultKind }))\n        .join(', ');\n    }\n\n    return {\n      title,\n      customFilterAndSearch(filter, entity) {\n        return formatContent(entity).includes(filter);\n      },\n      customSort(entity1, entity2) {\n        return formatContent(entity1).localeCompare(formatContent(entity2));\n      },\n      render: entity => {\n        return (\n          <EntityRefLinks\n            entityRefs={getRelations(entity)}\n            defaultKind={defaultKind}\n          />\n        );\n      },\n    };\n  },\n  createOwnerColumn<T extends Entity>(): TableColumn<T> {\n    return this.createEntityRelationColumn({\n      title: 'Owner',\n      relation: RELATION_OWNED_BY,\n      defaultKind: 'group',\n    });\n  },\n  createDomainColumn<T extends Entity>(): TableColumn<T> {\n    return this.createEntityRelationColumn({\n      title: 'Domain',\n      relation: RELATION_PART_OF,\n      defaultKind: 'domain',\n      filter: {\n        kind: 'domain',\n      },\n    });\n  },\n  createSystemColumn<T extends Entity>(): TableColumn<T> {\n    return this.createEntityRelationColumn({\n      title: 'System',\n      relation: RELATION_PART_OF,\n      defaultKind: 'system',\n      filter: {\n        kind: 'system',\n      },\n    });\n  },\n  createMetadataDescriptionColumn<T extends Entity>(): TableColumn<T> {\n    return {\n      title: 'Description',\n      field: 'metadata.description',\n      render: entity => (\n        <OverflowTooltip\n          text={entity.metadata.description}\n          placement=\"bottom-start\"\n          line={2}\n        />\n      ),\n      width: 'auto',\n    };\n  },\n  createSpecLifecycleColumn<T extends Entity>(): TableColumn<T> {\n    return {\n      title: 'Lifecycle',\n      field: 'spec.lifecycle',\n    };\n  },\n  createSpecTypeColumn<T extends Entity>(): TableColumn<T> {\n    return {\n      title: 'Type',\n      field: 'spec.type',\n    };\n  },\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ComponentEntity, SystemEntity } from '@backstage/catalog-model';\nimport { TableColumn } from '@backstage/core-components';\nimport { columnFactories } from './columns';\n\nexport const systemEntityColumns: TableColumn<SystemEntity>[] = [\n  columnFactories.createEntityRefColumn({ defaultKind: 'system' }),\n  columnFactories.createDomainColumn(),\n  columnFactories.createOwnerColumn(),\n  columnFactories.createMetadataDescriptionColumn(),\n];\n\nexport const componentEntityColumns: TableColumn<ComponentEntity>[] = [\n  columnFactories.createEntityRefColumn({ defaultKind: 'component' }),\n  columnFactories.createSystemColumn(),\n  columnFactories.createOwnerColumn(),\n  columnFactories.createSpecTypeColumn(),\n  columnFactories.createSpecLifecycleColumn(),\n  columnFactories.createMetadataDescriptionColumn(),\n];\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { makeStyles } from '@material-ui/core';\nimport React, { ReactNode } from 'react';\nimport { columnFactories } from './columns';\nimport { componentEntityColumns, systemEntityColumns } from './presets';\nimport { Table, TableColumn } from '@backstage/core-components';\n\n/**\n * Props for {@link EntityTable}.\n *\n * @public\n */\nexport interface EntityTableProps<T extends Entity> {\n  title: string;\n  variant?: 'gridItem';\n  entities: T[];\n  emptyContent?: ReactNode;\n  columns: TableColumn<T>[];\n}\n\nconst useStyles = makeStyles(theme => ({\n  empty: {\n    padding: theme.spacing(2),\n    display: 'flex',\n    justifyContent: 'center',\n  },\n}));\n\n/**\n * A general entity table component, that can be used for composing more\n * specific entity tables.\n *\n * @public\n */\nexport const EntityTable = <T extends Entity>(props: EntityTableProps<T>) => {\n  const {\n    entities,\n    title,\n    emptyContent,\n    variant = 'gridItem',\n    columns,\n  } = props;\n\n  const classes = useStyles();\n  const tableStyle: React.CSSProperties = {\n    minWidth: '0',\n    width: '100%',\n  };\n\n  if (variant === 'gridItem') {\n    tableStyle.height = 'calc(100% - 10px)';\n  }\n\n  return (\n    <Table<T>\n      columns={columns}\n      title={title}\n      style={tableStyle}\n      emptyContent={\n        emptyContent && <div className={classes.empty}>{emptyContent}</div>\n      }\n      options={{\n        // TODO: Toolbar padding if off compared to other cards, should be: padding: 16px 24px;\n        search: false,\n        paging: false,\n        actionsColumnIndex: -1,\n        padding: 'dense',\n      }}\n      data={entities}\n    />\n  );\n};\n\nEntityTable.columns = columnFactories;\n\nEntityTable.systemEntityColumns = systemEntityColumns;\n\nEntityTable.componentEntityColumns = componentEntityColumns;\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport {\n  Box,\n  Checkbox,\n  FormControlLabel,\n  makeStyles,\n  TextField,\n  Typography,\n} from '@material-ui/core';\nimport CheckBoxIcon from '@material-ui/icons/CheckBox';\nimport CheckBoxOutlineBlankIcon from '@material-ui/icons/CheckBoxOutlineBlank';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport { Autocomplete } from '@material-ui/lab';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useEntityList } from '../../hooks/useEntityListProvider';\nimport { EntityTagFilter } from '../../filters';\n\n/** @public */\nexport type CatalogReactEntityTagPickerClassKey = 'input';\n\nconst useStyles = makeStyles(\n  {\n    input: {},\n  },\n  {\n    name: 'CatalogReactEntityTagPicker',\n  },\n);\n\nconst icon = <CheckBoxOutlineBlankIcon fontSize=\"small\" />;\nconst checkedIcon = <CheckBoxIcon fontSize=\"small\" />;\n\n/** @public */\nexport const EntityTagPicker = () => {\n  const classes = useStyles();\n  const { updateFilters, backendEntities, filters, queryParameters } =\n    useEntityList();\n\n  const queryParamTags = useMemo(\n    () => [queryParameters.tags].flat().filter(Boolean) as string[],\n    [queryParameters],\n  );\n\n  const [selectedTags, setSelectedTags] = useState(\n    queryParamTags.length ? queryParamTags : filters.tags?.values ?? [],\n  );\n\n  // Set selected tags on query parameter updates; this happens at initial page load and from\n  // external updates to the page location.\n  useEffect(() => {\n    if (queryParamTags.length) {\n      setSelectedTags(queryParamTags);\n    }\n  }, [queryParamTags]);\n\n  useEffect(() => {\n    updateFilters({\n      tags: selectedTags.length ? new EntityTagFilter(selectedTags) : undefined,\n    });\n  }, [selectedTags, updateFilters]);\n\n  const availableTags = useMemo(\n    () =>\n      [\n        ...new Set(\n          backendEntities\n            .flatMap((e: Entity) => e.metadata.tags)\n            .filter(Boolean) as string[],\n        ),\n      ].sort(),\n    [backendEntities],\n  );\n\n  if (!availableTags.length) return null;\n\n  return (\n    <Box pb={1} pt={1}>\n      <Typography variant=\"button\">Tags</Typography>\n      <Autocomplete\n        multiple\n        aria-label=\"Tags\"\n        options={availableTags}\n        value={selectedTags}\n        onChange={(_: object, value: string[]) => setSelectedTags(value)}\n        renderOption={(option, { selected }) => (\n          <FormControlLabel\n            control={\n              <Checkbox\n                icon={icon}\n                checkedIcon={checkedIcon}\n                checked={selected}\n              />\n            }\n            label={option}\n          />\n        )}\n        size=\"small\"\n        popupIcon={<ExpandMoreIcon data-testid=\"tag-picker-expand\" />}\n        renderInput={params => (\n          <TextField {...params} className={classes.input} variant=\"outlined\" />\n        )}\n      />\n    </Box>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect } from 'react';\nimport capitalize from 'lodash/capitalize';\nimport { Box } from '@material-ui/core';\nimport { useEntityTypeFilter } from '../../hooks/useEntityTypeFilter';\n\nimport { alertApiRef, useApi } from '@backstage/core-plugin-api';\nimport { Select } from '@backstage/core-components';\n\n/**\n * Props for {@link EntityTypePicker}.\n *\n * @public\n */\nexport interface EntityTypePickerProps {\n  initialFilter?: string;\n  hidden?: boolean;\n}\n\n/** @public */\nexport const EntityTypePicker = (props: EntityTypePickerProps) => {\n  const { hidden, initialFilter } = props;\n  const alertApi = useApi(alertApiRef);\n  const { error, availableTypes, selectedTypes, setSelectedTypes } =\n    useEntityTypeFilter();\n\n  useEffect(() => {\n    if (error) {\n      alertApi.post({\n        message: `Failed to load entity types`,\n        severity: 'error',\n      });\n    }\n    if (initialFilter) {\n      setSelectedTypes([initialFilter]);\n    }\n  }, [error, alertApi, initialFilter, setSelectedTypes]);\n\n  if (availableTypes.length === 0 || error) return null;\n\n  const items = [\n    { value: 'all', label: 'All' },\n    ...availableTypes.map((type: string) => ({\n      value: type,\n      label: capitalize(type),\n    })),\n  ];\n\n  return hidden ? null : (\n    <Box pb={1} pt={1}>\n      <Select\n        label=\"Type\"\n        items={items}\n        selected={(items.length > 1 ? selectedTypes[0] : undefined) ?? 'all'}\n        onChange={value =>\n          setSelectedTypes(value === 'all' ? [] : [String(value)])\n        }\n      />\n    </Box>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { IconButton, Tooltip, withStyles } from '@material-ui/core';\nimport Star from '@material-ui/icons/Star';\nimport StarBorder from '@material-ui/icons/StarBorder';\nimport React, { ComponentProps } from 'react';\nimport { useStarredEntity } from '../../hooks/useStarredEntity';\n\n/** @public */\nexport type FavoriteEntityProps = ComponentProps<typeof IconButton> & {\n  entity: Entity;\n};\n\nconst YellowStar = withStyles({\n  root: {\n    color: '#f3ba37',\n  },\n})(Star);\n\n/**\n * @public\n * @deprecated due to low utility value.\n */\nexport const favoriteEntityTooltip = (isStarred: boolean) =>\n  isStarred ? 'Remove from favorites' : 'Add to favorites';\n\n/**\n * @public\n * @deprecated due to low utility value.\n */\nexport const favoriteEntityIcon = (isStarred: boolean) =>\n  isStarred ? <YellowStar /> : <StarBorder />;\n\n/**\n * IconButton for showing if a current entity is starred and adding/removing it from the favorite entities\n * @param props - MaterialUI IconButton props extended by required `entity` prop\n * @public\n */\nexport const FavoriteEntity = (props: FavoriteEntityProps) => {\n  const { toggleStarredEntity, isStarredEntity } = useStarredEntity(\n    props.entity,\n  );\n  return (\n    <IconButton\n      color=\"inherit\"\n      {...props}\n      onClick={() => toggleStarredEntity()}\n    >\n      <Tooltip\n        title={isStarredEntity ? 'Remove from favorites' : 'Add to favorites'}\n      >\n        {isStarredEntity ? <YellowStar /> : <StarBorder />}\n      </Tooltip>\n    </IconButton>\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { parseEntityRef } from '@backstage/catalog-model';\nimport { useApp } from '@backstage/core-plugin-api';\nimport WorkIcon from '@material-ui/icons/Work';\nimport React from 'react';\n\nconst DEFAULT_ICON = WorkIcon;\n\nfunction getKind(\n  kind: string | undefined,\n  entityRef: string | undefined,\n): string | undefined {\n  if (kind) {\n    return kind.toLocaleLowerCase('en-US');\n  }\n\n  if (entityRef) {\n    try {\n      return parseEntityRef(entityRef).kind.toLocaleLowerCase('en-US');\n    } catch {\n      return undefined;\n    }\n  }\n\n  return undefined;\n}\n\nfunction useIcon(kind: string | undefined, entityRef: string | undefined) {\n  const app = useApp();\n\n  const actualKind = getKind(kind, entityRef);\n  if (!actualKind) {\n    return DEFAULT_ICON;\n  }\n\n  const icon = app.getSystemIcon(`kind:${actualKind}`);\n  return icon || DEFAULT_ICON;\n}\n\nexport function EntityKindIcon(props: {\n  kind?: string;\n  entityRef?: string;\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n  className?: string;\n}) {\n  const { kind, entityRef, ...otherProps } = props;\n  const Icon = useIcon(kind, entityRef);\n  return <Icon {...otherProps} />;\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  DEFAULT_NAMESPACE,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  DependencyGraph,\n  DependencyGraphTypes,\n  Link,\n  Progress,\n  ResponseErrorPanel,\n} from '@backstage/core-components';\nimport { useApi, useRouteRef } from '@backstage/core-plugin-api';\nimport { Box, DialogContentText, makeStyles } from '@material-ui/core';\nimport classNames from 'classnames';\nimport React, { useLayoutEffect, useRef, useState } from 'react';\nimport { useNavigate } from 'react-router';\nimport useAsync from 'react-use/lib/useAsync';\nimport { catalogApiRef } from '../../../api';\nimport { humanizeEntityRef } from '../../EntityRefLink';\nimport { entityRouteRef } from '../../../routes';\nimport { EntityKindIcon } from './EntityKindIcon';\n\nconst useStyles = makeStyles(theme => ({\n  node: {\n    fill: theme.palette.grey[300],\n    stroke: theme.palette.grey[300],\n    '&.primary': {\n      fill: theme.palette.primary.light,\n      stroke: theme.palette.primary.light,\n    },\n    '&.secondary': {\n      fill: theme.palette.secondary.light,\n      stroke: theme.palette.secondary.light,\n    },\n  },\n  text: {\n    fill: theme.palette.getContrastText(theme.palette.grey[300]),\n    '&.primary': {\n      fill: theme.palette.primary.contrastText,\n    },\n    '&.secondary': {\n      fill: theme.palette.secondary.contrastText,\n    },\n    '&.focused': {\n      fontWeight: 'bold',\n    },\n  },\n  clickable: {\n    cursor: 'pointer',\n  },\n}));\n\ntype NodeType = Entity & { root: boolean };\n\nfunction useAncestry(root: Entity): {\n  loading: boolean;\n  error?: Error;\n  nodes: DependencyGraphTypes.DependencyNode<NodeType>[];\n  edges: DependencyGraphTypes.DependencyEdge[];\n} {\n  const catalogClient = useApi(catalogApiRef);\n  const entityRef = stringifyEntityRef(root);\n\n  const { loading, error, value } = useAsync(async () => {\n    const response = await catalogClient.getEntityAncestors({ entityRef });\n    const nodes = new Array<DependencyGraphTypes.DependencyNode<NodeType>>();\n    const edges = new Array<DependencyGraphTypes.DependencyEdge>();\n    for (const current of response.items) {\n      const currentRef = stringifyEntityRef(current.entity);\n      const isRootNode = currentRef === response.rootEntityRef;\n      nodes.push({ id: currentRef, root: isRootNode, ...current.entity });\n      for (const parentRef of current.parentEntityRefs) {\n        edges.push({ from: currentRef, to: parentRef });\n      }\n    }\n    return { nodes, edges };\n  }, [entityRef]);\n\n  return {\n    loading,\n    error,\n    nodes: value?.nodes || [],\n    edges: value?.edges || [],\n  };\n}\n\nfunction CustomNode({ node }: DependencyGraphTypes.RenderNodeProps<NodeType>) {\n  const classes = useStyles();\n  const navigate = useNavigate();\n  const entityRoute = useRouteRef(entityRouteRef);\n  const [width, setWidth] = useState(0);\n  const [height, setHeight] = useState(0);\n  const idRef = useRef<SVGTextElement | null>(null);\n\n  useLayoutEffect(() => {\n    // set the width to the length of the ID\n    if (idRef.current) {\n      let { height: renderedHeight, width: renderedWidth } =\n        idRef.current.getBBox();\n      renderedHeight = Math.round(renderedHeight);\n      renderedWidth = Math.round(renderedWidth);\n      if (renderedHeight !== height || renderedWidth !== width) {\n        setWidth(renderedWidth);\n        setHeight(renderedHeight);\n      }\n    }\n  }, [width, height]);\n\n  const padding = 10;\n  const iconSize = height;\n  const paddedIconWidth = iconSize + padding;\n  const paddedWidth = paddedIconWidth + width + padding * 2;\n  const paddedHeight = height + padding * 2;\n\n  const displayTitle =\n    node.metadata.title ||\n    (node.kind && node.metadata.name && node.metadata.namespace\n      ? humanizeEntityRef({\n          kind: node.kind,\n          name: node.metadata.name,\n          namespace: node.metadata.namespace || '',\n        })\n      : node.id);\n\n  const onClick = () => {\n    navigate(\n      entityRoute({\n        kind: node.kind,\n        namespace: node.metadata.namespace || DEFAULT_NAMESPACE,\n        name: node.metadata.name,\n      }),\n    );\n  };\n\n  return (\n    <g onClick={onClick} className={classes.clickable}>\n      <rect\n        className={classNames(\n          classes.node,\n          node.root ? 'secondary' : 'primary',\n        )}\n        width={paddedWidth}\n        height={paddedHeight}\n        rx={10}\n      />\n      <EntityKindIcon\n        kind={node.kind}\n        y={padding}\n        x={padding}\n        width={iconSize}\n        height={iconSize}\n        className={classNames(\n          classes.text,\n          node.root ? 'secondary' : 'primary',\n        )}\n      />\n      <text\n        ref={idRef}\n        className={classNames(\n          classes.text,\n          node.root ? 'secondary' : 'primary',\n        )}\n        y={paddedHeight / 2}\n        x={paddedIconWidth + (width + padding * 2) / 2}\n        textAnchor=\"middle\"\n        alignmentBaseline=\"middle\"\n      >\n        {displayTitle}\n      </text>\n    </g>\n  );\n}\n\nexport function AncestryPage(props: { entity: Entity }) {\n  const { loading, error, nodes, edges } = useAncestry(props.entity);\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return <ResponseErrorPanel error={error} />;\n  }\n\n  return (\n    <>\n      <DialogContentText variant=\"h2\">Ancestry</DialogContentText>\n      <DialogContentText gutterBottom>\n        This is the ancestry of entities above the current one - as in, the\n        chain(s) of entities down to the current one, where{' '}\n        <Link to=\"https://backstage.io/docs/features/software-catalog/life-of-an-entity\">\n          processors emitted\n        </Link>{' '}\n        child entities that ultimately led to the current one existing. Note\n        that this is a completely different mechanism from relations.\n      </DialogContentText>\n      <Box mt={4}>\n        <DependencyGraph\n          nodes={nodes}\n          edges={edges}\n          renderNode={CustomNode}\n          direction={DependencyGraphTypes.Direction.BOTTOM_TOP}\n          zoom=\"enable-on-click\"\n        />\n      </Box>\n    </>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Link } from '@backstage/core-components';\nimport {\n  Box,\n  Card,\n  CardContent,\n  ListItem,\n  ListItemIcon,\n  ListItemText as MuiListItemText,\n  ListSubheader as MuiListSubheader,\n  makeStyles,\n  Typography,\n} from '@material-ui/core';\nimport HelpOutlineIcon from '@material-ui/icons/HelpOutline';\nimport React from 'react';\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n  },\n  marginTop: {\n    marginTop: theme.spacing(2),\n  },\n  helpIcon: {\n    marginLeft: theme.spacing(1),\n    color: theme.palette.text.disabled,\n  },\n  monospace: {\n    fontFamily: 'monospace',\n  },\n}));\n\nexport function ListItemText(props: {\n  primary: React.ReactNode;\n  secondary?: React.ReactNode;\n}) {\n  const classes = useStyles();\n  return (\n    <MuiListItemText\n      {...props}\n      primaryTypographyProps={{ className: classes.monospace }}\n      secondaryTypographyProps={{ className: classes.monospace }}\n    />\n  );\n}\n\nexport function ListSubheader(props: { children?: React.ReactNode }) {\n  const classes = useStyles();\n  return (\n    <MuiListSubheader className={classes.monospace}>\n      {props.children}\n    </MuiListSubheader>\n  );\n}\n\nexport function Container(props: {\n  title: React.ReactNode;\n  helpLink?: string;\n  children: React.ReactNode;\n}) {\n  return (\n    <Box mt={2}>\n      <Card variant=\"outlined\">\n        <CardContent>\n          <Typography variant=\"h6\" gutterBottom>\n            {props.title}\n            {props.helpLink && <HelpIcon to={props.helpLink} />}\n          </Typography>\n          {props.children}\n        </CardContent>\n      </Card>\n    </Box>\n  );\n}\n\nexport function KeyValueListItem(props: {\n  indent?: boolean;\n  entry: [string, string];\n}) {\n  const [key, value] = props.entry;\n  return (\n    <ListItem>\n      {props.indent && <ListItemIcon />}\n      <ListItemText\n        primary={key}\n        secondary={\n          !value.match(/^url:https?:\\/\\//) ? (\n            value\n          ) : (\n            <>\n              {value.substring(0, 4)}\n              <Link to={value.substring(4)}>{value.substring(4)}</Link>\n            </>\n          )\n        }\n      />\n    </ListItem>\n  );\n}\n\nexport function HelpIcon(props: { to: string }) {\n  const classes = useStyles();\n  return (\n    <Link to={props.to} className={classes.helpIcon}>\n      <HelpOutlineIcon fontSize=\"inherit\" />\n    </Link>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  ANNOTATION_LOCATION,\n  ANNOTATION_ORIGIN_LOCATION,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { Progress, ResponseErrorPanel } from '@backstage/core-components';\nimport { useApi } from '@backstage/core-plugin-api';\nimport {\n  DialogContentText,\n  List,\n  ListItem,\n  ListItemIcon,\n  makeStyles,\n} from '@material-ui/core';\nimport { Alert } from '@material-ui/lab';\nimport React from 'react';\nimport useAsync from 'react-use/lib/useAsync';\nimport { catalogApiRef } from '../../../api';\nimport { EntityRefLink } from '../../EntityRefLink';\nimport { KeyValueListItem, ListItemText } from './common';\nimport { EntityKindIcon } from './EntityKindIcon';\n\nconst useStyles = makeStyles({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n  },\n});\n\nfunction useColocated(entity: Entity): {\n  loading: boolean;\n  error?: Error;\n  location?: string;\n  originLocation?: string;\n  colocatedEntities?: Entity[];\n} {\n  const catalogApi = useApi(catalogApiRef);\n  const currentEntityRef = stringifyEntityRef(entity);\n  const location = entity.metadata.annotations?.[ANNOTATION_LOCATION];\n  const origin = entity.metadata.annotations?.[ANNOTATION_ORIGIN_LOCATION];\n\n  const { loading, error, value } = useAsync(async () => {\n    if (!location && !origin) {\n      return [];\n    }\n    const response = await catalogApi.getEntities({\n      filter: [\n        ...(location\n          ? [{ [`metadata.annotations.${ANNOTATION_LOCATION}`]: location }]\n          : []),\n        ...(origin\n          ? [{ [`metadata.annotations.${ANNOTATION_ORIGIN_LOCATION}`]: origin }]\n          : []),\n      ],\n    });\n    return response.items;\n  }, [location, origin]);\n\n  return {\n    loading,\n    error,\n    location,\n    originLocation: origin,\n    colocatedEntities: value?.filter(\n      colocated => stringifyEntityRef(colocated) !== currentEntityRef,\n    ),\n  };\n}\n\nfunction EntityList(props: { entities: Entity[]; header?: [string, string] }) {\n  return (\n    <List dense>\n      {props.header && <KeyValueListItem key=\"header\" entry={props.header} />}\n      {props.entities.map(entity => (\n        <ListItem key={stringifyEntityRef(entity)}>\n          <ListItemIcon>\n            <EntityKindIcon kind={entity.kind} />\n          </ListItemIcon>\n          <ListItemText primary={<EntityRefLink entityRef={entity} />} />\n        </ListItem>\n      ))}\n    </List>\n  );\n}\n\nfunction Contents(props: { entity: Entity }) {\n  const { entity } = props;\n\n  const { loading, error, location, originLocation, colocatedEntities } =\n    useColocated(entity);\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return <ResponseErrorPanel error={error} />;\n  }\n\n  if (!location && !originLocation) {\n    return (\n      <Alert severity=\"warning\">Entity had no location information.</Alert>\n    );\n  } else if (!colocatedEntities?.length) {\n    return (\n      <Alert severity=\"info\">\n        There were no other entities on this location.\n      </Alert>\n    );\n  }\n\n  if (location === originLocation) {\n    return <EntityList entities={colocatedEntities} />;\n  }\n\n  const atLocation = colocatedEntities.filter(\n    e => e.metadata.annotations?.[ANNOTATION_LOCATION] === location,\n  );\n  const atOrigin = colocatedEntities.filter(\n    e =>\n      e.metadata.annotations?.[ANNOTATION_ORIGIN_LOCATION] === originLocation,\n  );\n\n  return (\n    <>\n      {atLocation.length > 0 && (\n        <EntityList\n          entities={atLocation}\n          header={['At the same location', location!]}\n        />\n      )}\n      {atOrigin.length > 0 && (\n        <EntityList\n          entities={atOrigin}\n          header={['At the same origin', originLocation!]}\n        />\n      )}\n    </>\n  );\n}\n\nexport function ColocatedPage(props: { entity: Entity }) {\n  const classes = useStyles();\n  return (\n    <>\n      <DialogContentText variant=\"h2\">Colocated</DialogContentText>\n      <DialogContentText>\n        These are the entities that are colocated with this entity - as in, they\n        originated from the same data source (e.g. came from the same YAML\n        file), or from the same origin (e.g. the originally registered URL).\n      </DialogContentText>\n      <div className={classes.root}>\n        <Contents entity={props.entity} />\n      </div>\n    </>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonObject } from '@backstage/types';\n\nexport function sortKeys(data: JsonObject): JsonObject {\n  // we could do something custom, but lexicographical sorting is actually a\n  // good choice at least for the default set of keys\n  return Object.fromEntries(\n    [...Object.entries(data)].sort((a, b) => (a[0] < b[0] ? -1 : 1)),\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { CodeSnippet } from '@backstage/core-components';\nimport { DialogContentText } from '@material-ui/core';\nimport React from 'react';\nimport { sortKeys } from './util';\n\nexport function JsonPage(props: { entity: Entity }) {\n  return (\n    <>\n      <DialogContentText variant=\"h2\">Entity as JSON</DialogContentText>\n      <DialogContentText>\n        This is the raw entity data as received from the catalog, on JSON form.\n      </DialogContentText>\n      <DialogContentText>\n        <div style={{ fontSize: '75%' }} data-testid=\"code-snippet\">\n          <CodeSnippet\n            text={JSON.stringify(sortKeys(props.entity), undefined, 2)}\n            language=\"json\"\n            showCopyCodeButton\n          />\n        </div>\n      </DialogContentText>\n    </>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AlphaEntity } from '@backstage/catalog-model';\nimport {\n  Box,\n  DialogContentText,\n  List,\n  ListItem,\n  ListItemIcon,\n  makeStyles,\n  Typography,\n} from '@material-ui/core';\nimport groupBy from 'lodash/groupBy';\nimport sortBy from 'lodash/sortBy';\nimport React from 'react';\nimport { EntityRefLink } from '../../EntityRefLink';\nimport {\n  Container,\n  HelpIcon,\n  KeyValueListItem,\n  ListItemText,\n  ListSubheader,\n} from './common';\nimport { EntityKindIcon } from './EntityKindIcon';\n\nconst useStyles = makeStyles({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n  },\n});\n\nexport function OverviewPage(props: { entity: AlphaEntity }) {\n  const classes = useStyles();\n  const {\n    apiVersion,\n    kind,\n    metadata,\n    spec,\n    relations = [],\n    status = {},\n  } = props.entity;\n\n  const groupedRelations = groupBy(\n    sortBy(relations, r => r.targetRef),\n    'type',\n  );\n\n  return (\n    <>\n      <DialogContentText variant=\"h2\">Overview</DialogContentText>\n      <div className={classes.root}>\n        <Container title=\"Identity\">\n          <List dense>\n            <ListItem>\n              <ListItemText primary=\"apiVersion\" secondary={apiVersion} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"kind\" secondary={kind} />\n            </ListItem>\n            {spec?.type && (\n              <ListItem>\n                <ListItemText primary=\"spec.type\" secondary={spec.type} />\n              </ListItem>\n            )}\n            {metadata.uid && (\n              <ListItem>\n                <ListItemText primary=\"uid\" secondary={metadata.uid} />\n              </ListItem>\n            )}\n            {metadata.etag && (\n              <ListItem>\n                <ListItemText primary=\"etag\" secondary={metadata.etag} />\n              </ListItem>\n            )}\n          </List>\n        </Container>\n\n        <Container title=\"Metadata\">\n          {!!Object.keys(metadata.annotations || {}).length && (\n            <List\n              dense\n              subheader={\n                <ListSubheader>\n                  Annotations\n                  <HelpIcon to=\"https://backstage.io/docs/features/software-catalog/well-known-annotations\" />\n                </ListSubheader>\n              }\n            >\n              {Object.entries(metadata.annotations!).map(entry => (\n                <KeyValueListItem key={entry[0]} indent entry={entry} />\n              ))}\n            </List>\n          )}\n          {!!Object.keys(metadata.labels || {}).length && (\n            <List\n              dense\n              subheader={\n                <ListSubheader>\n                  Labels\n                  <HelpIcon to=\"https://backstage.io/docs/features/software-catalog/well-known-labels\" />\n                </ListSubheader>\n              }\n            >\n              {Object.entries(metadata.labels!).map(entry => (\n                <KeyValueListItem key={entry[0]} indent entry={entry} />\n              ))}\n            </List>\n          )}\n          {!!metadata.tags?.length && (\n            <List dense subheader={<ListSubheader>Tags</ListSubheader>}>\n              {metadata.tags.map((tag, index) => (\n                <ListItem key={`${tag}-${index}`}>\n                  <ListItemIcon />\n                  <ListItemText primary={tag} />\n                </ListItem>\n              ))}\n            </List>\n          )}\n        </Container>\n\n        {!!relations.length && (\n          <Container\n            title=\"Relations\"\n            helpLink=\"https://backstage.io/docs/features/software-catalog/well-known-relations\"\n          >\n            {Object.entries(groupedRelations).map(\n              ([type, groupRelations], index) => (\n                <div key={index}>\n                  <List dense subheader={<ListSubheader>{type}</ListSubheader>}>\n                    {groupRelations.map(group => (\n                      <ListItem key={group.targetRef}>\n                        <ListItemIcon>\n                          <EntityKindIcon entityRef={group.targetRef} />\n                        </ListItemIcon>\n                        <ListItemText\n                          primary={\n                            <EntityRefLink entityRef={group.targetRef} />\n                          }\n                        />\n                      </ListItem>\n                    ))}\n                  </List>\n                </div>\n              ),\n            )}\n          </Container>\n        )}\n\n        {!!status.items?.length && (\n          <Container\n            title=\"Status\"\n            helpLink=\"https://backstage.io/docs/features/software-catalog/well-known-statuses\"\n          >\n            {status.items.map((item, index) => (\n              <div key={index}>\n                <Typography>\n                  {item.level}: {item.type}\n                </Typography>\n                <Box ml={2}>{item.message}</Box>\n              </div>\n            ))}\n          </Container>\n        )}\n      </div>\n    </>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { CodeSnippet } from '@backstage/core-components';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport React from 'react';\nimport YAML from 'yaml';\nimport { sortKeys } from './util';\n\nexport function YamlPage(props: { entity: Entity }) {\n  return (\n    <>\n      <DialogContentText variant=\"h2\">Entity as YAML</DialogContentText>\n      <DialogContentText>\n        This is the raw entity data as received from the catalog, on YAML form.\n      </DialogContentText>\n      <DialogContentText>\n        <div style={{ fontSize: '75%' }} data-testid=\"code-snippet\">\n          <CodeSnippet\n            text={YAML.stringify(sortKeys(props.entity))}\n            language=\"yaml\"\n            showCopyCodeButton\n          />\n        </div>\n      </DialogContentText>\n    </>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport {\n  Box,\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  makeStyles,\n  Tab,\n  Tabs,\n} from '@material-ui/core';\nimport React, { useEffect } from 'react';\nimport { AncestryPage } from './components/AncestryPage';\nimport { ColocatedPage } from './components/ColocatedPage';\nimport { JsonPage } from './components/JsonPage';\nimport { OverviewPage } from './components/OverviewPage';\nimport { YamlPage } from './components/YamlPage';\n\nconst useStyles = makeStyles(theme => ({\n  fullHeightDialog: {\n    height: 'calc(100% - 64px)',\n  },\n  root: {\n    display: 'flex',\n    flexGrow: 1,\n    width: '100%',\n    backgroundColor: theme.palette.background.paper,\n  },\n  tabs: {\n    borderRight: `1px solid ${theme.palette.divider}`,\n    flexShrink: 0,\n  },\n  tabContents: {\n    flexGrow: 1,\n    overflowX: 'auto',\n  },\n}));\n\nfunction TabPanel(props: {\n  children?: React.ReactNode;\n  index: number;\n  value: number;\n}) {\n  const { children, value, index, ...other } = props;\n  const classes = useStyles();\n  return (\n    <div\n      role=\"tabpanel\"\n      hidden={value !== index}\n      id={`vertical-tabpanel-${index}`}\n      aria-labelledby={`vertical-tab-${index}`}\n      className={classes.tabContents}\n      {...other}\n    >\n      {value === index && (\n        <Box pl={3} pr={3}>\n          {children}\n        </Box>\n      )}\n    </div>\n  );\n}\n\nfunction a11yProps(index: number) {\n  return {\n    id: `vertical-tab-${index}`,\n    'aria-controls': `vertical-tabpanel-${index}`,\n  };\n}\n\n/**\n * A dialog that lets users inspect the low level details of their entities.\n *\n * @public\n */\nexport function InspectEntityDialog(props: {\n  open: boolean;\n  entity: Entity;\n  onClose: () => void;\n}) {\n  const classes = useStyles();\n  const [activeTab, setActiveTab] = React.useState(0);\n\n  useEffect(() => {\n    setActiveTab(0);\n  }, [props.open]);\n\n  if (!props.entity) {\n    return null;\n  }\n\n  return (\n    <Dialog\n      fullWidth\n      maxWidth=\"xl\"\n      open={props.open}\n      onClose={props.onClose}\n      aria-labelledby=\"entity-inspector-dialog-title\"\n      PaperProps={{ className: classes.fullHeightDialog }}\n    >\n      <DialogTitle id=\"entity-inspector-dialog-title\">\n        Entity Inspector\n      </DialogTitle>\n      <DialogContent dividers>\n        <div className={classes.root}>\n          <Tabs\n            orientation=\"vertical\"\n            variant=\"scrollable\"\n            value={activeTab}\n            onChange={(_, newValue) => setActiveTab(newValue)}\n            aria-label=\"Inspector options\"\n            className={classes.tabs}\n          >\n            <Tab label=\"Overview\" {...a11yProps(0)} />\n            <Tab label=\"Ancestry\" {...a11yProps(1)} />\n            <Tab label=\"Colocated\" {...a11yProps(2)} />\n            <Tab label=\"Raw JSON\" {...a11yProps(3)} />\n            <Tab label=\"Raw YAML\" {...a11yProps(4)} />\n          </Tabs>\n\n          <TabPanel value={activeTab} index={0}>\n            <OverviewPage entity={props.entity} />\n          </TabPanel>\n          <TabPanel value={activeTab} index={1}>\n            <AncestryPage entity={props.entity} />\n          </TabPanel>\n          <TabPanel value={activeTab} index={2}>\n            <ColocatedPage entity={props.entity} />\n          </TabPanel>\n          <TabPanel value={activeTab} index={3}>\n            <JsonPage entity={props.entity} />\n          </TabPanel>\n          <TabPanel value={activeTab} index={4}>\n            <YamlPage entity={props.entity} />\n          </TabPanel>\n        </div>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={props.onClose} color=\"primary\">\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  getCompoundEntityRef,\n  ANNOTATION_ORIGIN_LOCATION,\n} from '@backstage/catalog-model';\nimport { catalogApiRef } from '../../api';\nimport { useCallback } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\nimport { useApi } from '@backstage/core-plugin-api';\n\n/**\n * Each distinct state that the dialog can be in at any given time.\n */\nexport type UseUnregisterEntityDialogState =\n  | {\n      type: 'loading';\n    }\n  | {\n      type: 'error';\n      error: Error;\n    }\n  | {\n      type: 'bootstrap';\n      location: string;\n      deleteEntity: () => Promise<void>;\n    }\n  | {\n      type: 'unregister';\n      location: string;\n      colocatedEntities: CompoundEntityRef[];\n      unregisterLocation: () => Promise<void>;\n      deleteEntity: () => Promise<void>;\n    }\n  | {\n      type: 'only-delete';\n      deleteEntity: () => Promise<void>;\n    };\n\n/**\n * Houses the main logic for unregistering entities and their locations.\n */\nexport function useUnregisterEntityDialogState(\n  entity: Entity,\n): UseUnregisterEntityDialogState {\n  const catalogApi = useApi(catalogApiRef);\n  const locationRef = entity.metadata.annotations?.[ANNOTATION_ORIGIN_LOCATION];\n  const uid = entity.metadata.uid;\n  const isBootstrap = locationRef === 'bootstrap:bootstrap';\n\n  // Load the prerequisite data: what entities that are colocated with us, and\n  // what location that spawned us\n  const prerequisites = useAsync(async () => {\n    const locationPromise = catalogApi.getLocationByRef(locationRef!);\n\n    let colocatedEntitiesPromise: Promise<Entity[]>;\n    if (!locationRef) {\n      colocatedEntitiesPromise = Promise.resolve([]);\n    } else {\n      const locationAnnotationFilter = `metadata.annotations.${ANNOTATION_ORIGIN_LOCATION}`;\n      colocatedEntitiesPromise = catalogApi\n        .getEntities({\n          filter: { [locationAnnotationFilter]: locationRef },\n          fields: [\n            'kind',\n            'metadata.uid',\n            'metadata.name',\n            'metadata.namespace',\n          ],\n        })\n        .then(response => response.items);\n    }\n\n    return Promise.all([locationPromise, colocatedEntitiesPromise]).then(\n      ([location, colocatedEntities]) => ({\n        location,\n        colocatedEntities,\n      }),\n    );\n  }, [catalogApi, entity]);\n\n  // Unregisters the underlying location and removes all of the entities that\n  // are spawned from it. Can only ever be called when the prerequisites have\n  // finished loading successfully, and if there was a matching location.\n  const unregisterLocation = useCallback(\n    async function unregisterLocationFn() {\n      const { location, colocatedEntities } = prerequisites.value!;\n      await catalogApi.removeLocationById(location!.id);\n      await Promise.allSettled(\n        colocatedEntities.map(e =>\n          catalogApi.removeEntityByUid(e.metadata.uid!),\n        ),\n      );\n    },\n    [catalogApi, prerequisites],\n  );\n\n  // Just removes the entity, without affecting locations in any way.\n  const deleteEntity = useCallback(\n    async function deleteEntityFn() {\n      await catalogApi.removeEntityByUid(uid!);\n    },\n    [catalogApi, uid],\n  );\n\n  // If this is a bootstrap location entity, don't even block on loading\n  // prerequisites. We know that all that we will do is to offer to remove the\n  // entity, and that doesn't require anything from the prerequisites.\n  if (isBootstrap) {\n    return { type: 'bootstrap', location: locationRef!, deleteEntity };\n  }\n\n  // Return early if prerequisites still loading or failing\n  const { loading, error, value } = prerequisites;\n  if (loading) {\n    return { type: 'loading' };\n  } else if (error) {\n    return { type: 'error', error };\n  }\n\n  const { location, colocatedEntities } = value!;\n  if (!location) {\n    return { type: 'only-delete', deleteEntity };\n  }\n  return {\n    type: 'unregister',\n    location: locationRef!,\n    colocatedEntities: colocatedEntities.map(getCompoundEntityRef),\n    unregisterLocation,\n    deleteEntity,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { EntityRefLink } from '../EntityRefLink';\nimport {\n  Box,\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  DialogTitle,\n  Divider,\n  makeStyles,\n} from '@material-ui/core';\nimport Alert from '@material-ui/lab/Alert';\nimport React, { useCallback, useState } from 'react';\nimport { useUnregisterEntityDialogState } from './useUnregisterEntityDialogState';\n\nimport { alertApiRef, configApiRef, useApi } from '@backstage/core-plugin-api';\nimport { Progress, ResponseErrorPanel } from '@backstage/core-components';\nimport { assertError } from '@backstage/errors';\n\nconst useStyles = makeStyles({\n  advancedButton: {\n    fontSize: '0.7em',\n  },\n});\n\nconst Contents = ({\n  entity,\n  onConfirm,\n}: {\n  entity: Entity;\n  onConfirm: () => any;\n}) => {\n  const alertApi = useApi(alertApiRef);\n  const configApi = useApi(configApiRef);\n  const classes = useStyles();\n  const state = useUnregisterEntityDialogState(entity);\n  const [showDelete, setShowDelete] = useState(false);\n  const [busy, setBusy] = useState(false);\n  const appTitle = configApi.getOptionalString('app.title') ?? 'Backstage';\n\n  const onUnregister = useCallback(\n    async function onUnregisterFn() {\n      if ('unregisterLocation' in state) {\n        setBusy(true);\n        try {\n          await state.unregisterLocation();\n          onConfirm();\n        } catch (err) {\n          assertError(err);\n          alertApi.post({ message: err.message });\n        } finally {\n          setBusy(false);\n        }\n      }\n    },\n    [alertApi, onConfirm, state],\n  );\n\n  const onDelete = useCallback(\n    async function onDeleteFn() {\n      if ('deleteEntity' in state) {\n        setBusy(true);\n        try {\n          await state.deleteEntity();\n          onConfirm();\n        } catch (err) {\n          assertError(err);\n          alertApi.post({ message: err.message });\n        } finally {\n          setBusy(false);\n        }\n      }\n    },\n    [alertApi, onConfirm, state],\n  );\n\n  if (state.type === 'loading') {\n    return <Progress />;\n  }\n\n  if (state.type === 'error') {\n    return <ResponseErrorPanel error={state.error} />;\n  }\n\n  if (state.type === 'bootstrap') {\n    return (\n      <>\n        <Alert severity=\"info\">\n          You cannot unregister this entity, since it originates from a\n          protected Backstage configuration (location \"{state.location}\"). If\n          you believe this is in error, please contact the {appTitle}{' '}\n          integrator.\n        </Alert>\n\n        <Box marginTop={2}>\n          {!showDelete && (\n            <Button\n              variant=\"text\"\n              size=\"small\"\n              color=\"primary\"\n              className={classes.advancedButton}\n              onClick={() => setShowDelete(true)}\n            >\n              Advanced Options\n            </Button>\n          )}\n\n          {showDelete && (\n            <>\n              <DialogContentText>\n                You have the option to delete the entity itself from the\n                catalog. Note that this should only be done if you know that the\n                catalog file has been deleted at, or moved from, its origin\n                location. If that is not the case, the entity will reappear\n                shortly as the next refresh round is performed by the catalog.\n              </DialogContentText>\n              <Button\n                variant=\"contained\"\n                color=\"secondary\"\n                disabled={busy}\n                onClick={onDelete}\n              >\n                Delete Entity\n              </Button>\n            </>\n          )}\n        </Box>\n      </>\n    );\n  }\n\n  if (state.type === 'only-delete') {\n    return (\n      <>\n        <DialogContentText>\n          This entity does not seem to originate from a registered location. You\n          therefore only have the option to delete it outright from the catalog.\n        </DialogContentText>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          disabled={busy}\n          onClick={onDelete}\n        >\n          Delete Entity\n        </Button>\n      </>\n    );\n  }\n\n  if (state.type === 'unregister') {\n    return (\n      <>\n        <DialogContentText>\n          This action will unregister the following entities:\n        </DialogContentText>\n        <DialogContentText component=\"ul\">\n          {state.colocatedEntities.map(e => (\n            <li key={`${e.kind}:${e.namespace}/${e.name}`}>\n              <EntityRefLink entityRef={e} />\n            </li>\n          ))}\n        </DialogContentText>\n        <DialogContentText>\n          Located at the following location:\n        </DialogContentText>\n        <DialogContentText component=\"ul\">\n          <li>{state.location}</li>\n        </DialogContentText>\n        <DialogContentText>\n          To undo, just re-register the entity in {appTitle}.\n        </DialogContentText>\n        <Box marginTop={2}>\n          <Button\n            variant=\"contained\"\n            color=\"secondary\"\n            disabled={busy}\n            onClick={onUnregister}\n          >\n            Unregister Location\n          </Button>\n          {!showDelete && (\n            <Box component=\"span\" marginLeft={2}>\n              <Button\n                variant=\"text\"\n                size=\"small\"\n                color=\"primary\"\n                className={classes.advancedButton}\n                onClick={() => setShowDelete(true)}\n              >\n                Advanced Options\n              </Button>\n            </Box>\n          )}\n        </Box>\n\n        {showDelete && (\n          <>\n            <Box paddingTop={4} paddingBottom={4}>\n              <Divider />\n            </Box>\n            <DialogContentText>\n              You also have the option to delete the entity itself from the\n              catalog. Note that this should only be done if you know that the\n              catalog file has been deleted at, or moved from, its origin\n              location. If that is not the case, the entity will reappear\n              shortly as the next refresh round is performed by the catalog.\n            </DialogContentText>\n            <Button\n              variant=\"contained\"\n              color=\"secondary\"\n              disabled={busy}\n              onClick={onDelete}\n            >\n              Delete Entity\n            </Button>\n          </>\n        )}\n      </>\n    );\n  }\n\n  return <Alert severity=\"error\">Internal error: Unknown state</Alert>;\n};\n\n/** @public */\nexport type UnregisterEntityDialogProps = {\n  open: boolean;\n  onConfirm: () => any;\n  onClose: () => any;\n  entity: Entity;\n};\n\n/** @public */\nexport const UnregisterEntityDialog = (props: UnregisterEntityDialogProps) => {\n  const { open, onConfirm, onClose, entity } = props;\n  return (\n    <Dialog open={open} onClose={onClose}>\n      <DialogTitle id=\"responsive-dialog-title\">\n        Are you sure you want to unregister this entity?\n      </DialogTitle>\n      <DialogContent>\n        <Contents entity={entity} onConfirm={onConfirm} />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onClose} color=\"primary\">\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  configApiRef,\n  IconComponent,\n  useApi,\n} from '@backstage/core-plugin-api';\nimport {\n  Card,\n  List,\n  ListItemIcon,\n  ListItemSecondaryAction,\n  ListItemText,\n  makeStyles,\n  MenuItem,\n  Theme,\n  Typography,\n} from '@material-ui/core';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport StarIcon from '@material-ui/icons/Star';\nimport { compact } from 'lodash';\nimport React, { Fragment, useEffect, useMemo, useState } from 'react';\nimport { UserListFilter } from '../../filters';\nimport {\n  useEntityList,\n  useStarredEntities,\n  useEntityOwnership,\n} from '../../hooks';\nimport { UserListFilterKind } from '../../types';\nimport { reduceEntityFilters } from '../../utils';\n\n/** @public */\nexport type CatalogReactUserListPickerClassKey =\n  | 'root'\n  | 'title'\n  | 'listIcon'\n  | 'menuItem'\n  | 'groupWrapper';\n\nconst useStyles = makeStyles<Theme>(\n  theme => ({\n    root: {\n      backgroundColor: 'rgba(0, 0, 0, .11)',\n      boxShadow: 'none',\n      margin: theme.spacing(1, 0, 1, 0),\n    },\n    title: {\n      margin: theme.spacing(1, 0, 0, 1),\n      textTransform: 'uppercase',\n      fontSize: 12,\n      fontWeight: 'bold',\n    },\n    listIcon: {\n      minWidth: 30,\n      color: theme.palette.text.primary,\n    },\n    menuItem: {\n      minHeight: theme.spacing(6),\n    },\n    groupWrapper: {\n      margin: theme.spacing(1, 1, 2, 1),\n    },\n  }),\n  {\n    name: 'CatalogReactUserListPicker',\n  },\n);\n\nexport type ButtonGroup = {\n  name: string;\n  items: {\n    id: 'owned' | 'starred' | 'all';\n    label: string;\n    icon?: IconComponent;\n  }[];\n};\n\nfunction getFilterGroups(orgName: string | undefined): ButtonGroup[] {\n  return [\n    {\n      name: 'Personal',\n      items: [\n        {\n          id: 'owned',\n          label: 'Owned',\n          icon: SettingsIcon,\n        },\n        {\n          id: 'starred',\n          label: 'Starred',\n          icon: StarIcon,\n        },\n      ],\n    },\n    {\n      name: orgName ?? 'Company',\n      items: [\n        {\n          id: 'all',\n          label: 'All',\n        },\n      ],\n    },\n  ];\n}\n\n/** @public */\nexport type UserListPickerProps = {\n  initialFilter?: UserListFilterKind;\n  availableFilters?: UserListFilterKind[];\n};\n\n/** @public */\nexport const UserListPicker = (props: UserListPickerProps) => {\n  const { initialFilter, availableFilters } = props;\n  const classes = useStyles();\n  const configApi = useApi(configApiRef);\n  const orgName = configApi.getOptionalString('organization.name') ?? 'Company';\n  const {\n    filters,\n    updateFilters,\n    backendEntities,\n    queryParameters,\n    loading: loadingBackendEntities,\n  } = useEntityList();\n\n  // Remove group items that aren't in availableFilters and exclude\n  // any now-empty groups.\n  const userAndGroupFilterIds = ['starred', 'all'];\n  const filterGroups = getFilterGroups(orgName)\n    .map(filterGroup => ({\n      ...filterGroup,\n      items: filterGroup.items.filter(({ id }) =>\n        // TODO: avoid hardcoding kinds here\n        ['group', 'user'].some(kind => kind === queryParameters.kind)\n          ? userAndGroupFilterIds.includes(id)\n          : !availableFilters || availableFilters.includes(id),\n      ),\n    }))\n    .filter(({ items }) => !!items.length);\n\n  const { isStarredEntity } = useStarredEntities();\n  const { isOwnedEntity, loading: loadingEntityOwnership } =\n    useEntityOwnership();\n\n  const loading = loadingBackendEntities || loadingEntityOwnership;\n\n  // Static filters; used for generating counts of potentially unselected kinds\n  const ownedFilter = useMemo(\n    () => new UserListFilter('owned', isOwnedEntity, isStarredEntity),\n    [isOwnedEntity, isStarredEntity],\n  );\n  const starredFilter = useMemo(\n    () => new UserListFilter('starred', isOwnedEntity, isStarredEntity),\n    [isOwnedEntity, isStarredEntity],\n  );\n\n  const queryParamUserFilter = useMemo(\n    () => [queryParameters.user].flat()[0],\n    [queryParameters],\n  );\n\n  const [selectedUserFilter, setSelectedUserFilter] = useState(\n    queryParamUserFilter ?? initialFilter,\n  );\n\n  // To show proper counts for each section, apply all other frontend filters _except_ the user\n  // filter that's controlled by this picker.\n  const entitiesWithoutUserFilter = useMemo(\n    () =>\n      backendEntities.filter(\n        reduceEntityFilters(\n          compact(Object.values({ ...filters, user: undefined })),\n        ),\n      ),\n    [filters, backendEntities],\n  );\n\n  const filterCounts = useMemo<Record<string, number>>(\n    () => ({\n      all: entitiesWithoutUserFilter.length,\n      starred: entitiesWithoutUserFilter.filter(entity =>\n        starredFilter.filterEntity(entity),\n      ).length,\n      owned: entitiesWithoutUserFilter.filter(entity =>\n        ownedFilter.filterEntity(entity),\n      ).length,\n    }),\n    [entitiesWithoutUserFilter, starredFilter, ownedFilter],\n  );\n\n  // Set selected user filter on query parameter updates; this happens at initial page load and from\n  // external updates to the page location.\n  useEffect(() => {\n    if (queryParamUserFilter) {\n      setSelectedUserFilter(queryParamUserFilter as UserListFilterKind);\n    }\n  }, [queryParamUserFilter]);\n\n  useEffect(() => {\n    if (\n      !loading &&\n      !!selectedUserFilter &&\n      selectedUserFilter !== 'all' &&\n      filterCounts[selectedUserFilter] === 0\n    ) {\n      setSelectedUserFilter('all');\n    }\n  }, [loading, filterCounts, selectedUserFilter, setSelectedUserFilter]);\n\n  useEffect(() => {\n    updateFilters({\n      user: selectedUserFilter\n        ? new UserListFilter(\n            selectedUserFilter as UserListFilterKind,\n            isOwnedEntity,\n            isStarredEntity,\n          )\n        : undefined,\n    });\n  }, [selectedUserFilter, isOwnedEntity, isStarredEntity, updateFilters]);\n\n  return (\n    <Card className={classes.root}>\n      {filterGroups.map(group => (\n        <Fragment key={group.name}>\n          <Typography variant=\"subtitle2\" className={classes.title}>\n            {group.name}\n          </Typography>\n          <Card className={classes.groupWrapper}>\n            <List disablePadding dense>\n              {group.items.map(item => (\n                <MenuItem\n                  key={item.id}\n                  button\n                  divider\n                  onClick={() => setSelectedUserFilter(item.id)}\n                  selected={item.id === filters.user?.value}\n                  className={classes.menuItem}\n                  disabled={filterCounts[item.id] === 0}\n                  data-testid={`user-picker-${item.id}`}\n                >\n                  {item.icon && (\n                    <ListItemIcon className={classes.listIcon}>\n                      <item.icon fontSize=\"small\" />\n                    </ListItemIcon>\n                  )}\n                  <ListItemText>\n                    <Typography variant=\"body1\">{item.label}</Typography>\n                  </ListItemText>\n                  <ListItemSecondaryAction>\n                    {filterCounts[item.id] ?? '-'}\n                  </ListItemSecondaryAction>\n                </MenuItem>\n              ))}\n            </List>\n          </Card>\n        </Fragment>\n      ))}\n    </Card>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  PropsWithChildren,\n  useCallback,\n  useMemo,\n  useState,\n} from 'react';\nimport {\n  DefaultEntityFilters,\n  EntityListContext,\n  EntityListContextProps,\n} from '../hooks/useEntityListProvider';\n\n/** @public */\nexport const MockEntityListContextProvider = ({\n  children,\n  value,\n}: PropsWithChildren<{\n  value?: Partial<EntityListContextProps>;\n}>) => {\n  // Provides a default implementation that stores filter state, for testing components that\n  // reflect filter state.\n  const [filters, setFilters] = useState<DefaultEntityFilters>(\n    value?.filters ?? {},\n  );\n\n  const updateFilters = useCallback(\n    (\n      update:\n        | Partial<DefaultEntityFilters>\n        | ((\n            prevFilters: DefaultEntityFilters,\n          ) => Partial<DefaultEntityFilters>),\n    ) => {\n      setFilters(prevFilters => {\n        const newFilters =\n          typeof update === 'function' ? update(prevFilters) : update;\n        return { ...prevFilters, ...newFilters };\n      });\n    },\n    [],\n  );\n\n  // Memoize the default values since pickers have useEffect triggers on these; naively defaulting\n  // below with `?? <X>` breaks referential equality on subsequent updates.\n  const defaultValues = useMemo(\n    () => ({\n      entities: [],\n      backendEntities: [],\n      queryParameters: {},\n    }),\n    [],\n  );\n\n  const resolvedValue: EntityListContextProps = useMemo(\n    () => ({\n      entities: value?.entities ?? defaultValues.entities,\n      backendEntities: value?.backendEntities ?? defaultValues.backendEntities,\n      updateFilters: value?.updateFilters ?? updateFilters,\n      filters,\n      loading: value?.loading ?? false,\n      queryParameters: value?.queryParameters ?? defaultValues.queryParameters,\n      error: value?.error,\n    }),\n    [value, defaultValues, filters, updateFilters],\n  );\n\n  return (\n    <EntityListContext.Provider value={resolvedValue}>\n      {children}\n    </EntityListContext.Provider>\n  );\n};\n"],"names":["isEqual","getEntityRef","useStyles","icon","checkedIcon","MuiListItemText","MuiListSubheader","Contents","groupBy","DialogContentText","Alert","StarIcon","ListItemText"],"mappings":"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"}